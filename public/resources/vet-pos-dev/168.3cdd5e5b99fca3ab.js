"use strict";(self.webpackChunkvet_pos_dev=self.webpackChunkvet_pos_dev||[]).push([[168],{5787:(st,v,c)=>{c.r(v),c.d(v,{InventoryModule:()=>it});var g=c(177),l=c(9417),y=c(2183),p=c(6511),P=c(7468),t=c(4438),m=c(5993),b=c(5506),_=c(4747),f=c(4877),h=c(1063);const w=()=>({mode:"multiple"});function O(a,d){if(1&a){const e=t.RV6();t.j41(0,"dx-button",31),t.bIt("onClick",function(){const n=t.eBV(e).data,i=t.XpG();return t.Njj(i.openSingleAdjust(n))}),t.k0s(),t.j41(1,"dx-button",32),t.bIt("onClick",function(){const n=t.eBV(e).data,i=t.XpG();return t.Njj(i.openHistory(n))}),t.k0s()}}function E(a,d){if(1&a&&(t.j41(0,"p"),t.EFF(1,"Product: "),t.j41(2,"b"),t.EFF(3),t.k0s()()),2&a){const e=t.XpG();t.R7$(3),t.JRh(e.currentProduct.name)}}let M=(()=>{class a{constructor(e,o){this.inv=e,this.fb=o,this.products=[],this.popupVisible=!1,this.singlePopupVisible=!1,this.historyVisible=!1,this.selectedProducts=[],this.currentProduct=null,this.productHistory=[],this.bulkForm=this.fb.group({delta:[0]}),this.singleForm=this.fb.group({delta:[0]})}ngOnInit(){this.loadProducts()}loadProducts(){this.inv.list().subscribe({next:e=>this.products=e,error:()=>alert("Failed to load products.")})}onSelectionChanged(e){this.selectedProducts=e.selectedRowsData}openBulkAdjustment(){this.selectedProducts.length?(this.bulkForm.reset({delta:0}),this.popupVisible=!0):alert("Select at least one product.")}applyBulkAdjustment(){const e=this.bulkForm.value.delta;if(0===e)return alert("Enter a valid quantity.");const o=this.selectedProducts.map(n=>this.inv.adjustStock(n.id,e));(0,P.p)(o).subscribe({next:n=>{n.forEach(i=>{const r=this.products.find(s=>s.id===i.id);r&&(r.stock_quantity=i.stock_quantity)}),this.popupVisible=!1,this.selectedProducts=[],this.dataGrid.instance.clearSelection()},error:()=>alert("Failed to adjust some products.")})}openSingleAdjust(e){this.currentProduct=e,this.singleForm.reset({delta:0}),this.singlePopupVisible=!0}applySingleAdjustment(){const e=this.singleForm.value.delta;!this.currentProduct||0===e||this.inv.adjustStock(this.currentProduct.id,e).subscribe({next:o=>{const n=this.products.find(i=>i.id===o.id);n&&(n.stock_quantity=o.stock_quantity),this.singlePopupVisible=!1,this.currentProduct=null},error:()=>alert("Failed to adjust stock.")})}rowPrepared(e){"data"===e.rowType&&e.data.stock_quantity<=(e.data.lowStockThreshold||5)&&(e.rowElement.style.backgroundColor="#f8d7da")}openHistory(e){this.inv.getHistory(e.id).subscribe({next:o=>{this.productHistory=o,this.currentProduct=e,this.historyVisible=!0},error:()=>alert("Failed to load stock history.")})}static{this.\u0275fac=function(o){return new(o||a)(t.rXU(m.c),t.rXU(l.ok))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-inventory-list"]],viewQuery:function(o,n){if(1&o&&t.GBs(p.sjL,5),2&o){let i;t.mGM(i=t.lsd())&&(n.dataGrid=i.first)}},decls:37,vars:34,consts:[["grid",""],["actionCell",""],[1,"inventory-layout","p-4"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold"],["text","Bulk Adjust Stock","type","default",3,"onClick"],[3,"onSelectionChanged","onRowPrepared","dataSource","showBorders","columnAutoWidth","selection"],["dataField","name","caption","Product",3,"width"],["dataField","sku","caption","SKU",3,"width"],["dataField","stock_quantity","caption","Current Stock",3,"width"],["dataField","lowStockThreshold","caption","Low Stock Limit",3,"width"],["caption","Actions","cellTemplate","actionCell",3,"width"],["title","Bulk Stock Adjustment",3,"visibleChange","visible","width","height","showTitle"],[1,"p-4","space-y-4",3,"formGroup"],["formControlName","delta","placeholder","Enter quantity to adjust (+ or -)",3,"showSpinButtons"],[1,"flex","justify-end","gap-2","mt-6"],["text","Cancel","type","default",3,"onClick"],["text","Apply","type","success",3,"onClick"],["title","Adjust Stock",3,"visibleChange","visible","width","height","showTitle"],[1,"p-4","space-y-4"],[4,"ngIf"],[3,"formGroup"],[3,"visibleChange","visible","width","height","showTitle","title"],[1,"p-4"],[3,"dataSource","showBorders","columnAutoWidth"],["dataField","created_at","caption","Date",3,"width"],["dataField","delta","caption","Change",3,"width"],["dataField","previous_quantity","caption","Previous"],["dataField","new_quantity","caption","New"],["dataField","reason","caption","Reason"],["dataField","adjusted_by","caption","Adjusted By",3,"width"],["text","Adjust","icon","edit","stylingMode","text",3,"onClick"],["text","History","icon","clock","stylingMode","text",3,"onClick"]],template:function(o,n){if(1&o){const i=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"h3",4),t.EFF(3,"Inventory Management"),t.k0s(),t.j41(4,"dx-button",5),t.bIt("onClick",function(){return t.eBV(i),t.Njj(n.openBulkAdjustment())}),t.k0s()(),t.j41(5,"dx-data-grid",6,0),t.bIt("onSelectionChanged",function(s){return t.eBV(i),t.Njj(n.onSelectionChanged(s))})("onRowPrepared",function(s){return t.eBV(i),t.Njj(n.rowPrepared(s))}),t.nrm(7,"dxi-column",7)(8,"dxi-column",8)(9,"dxi-column",9)(10,"dxi-column",10)(11,"dxi-column",11),t.DNE(12,O,2,0,"ng-template",null,1,t.C5r),t.k0s(),t.j41(14,"dx-popup",12),t.mxI("visibleChange",function(s){return t.eBV(i),t.DH7(n.popupVisible,s)||(n.popupVisible=s),t.Njj(s)}),t.j41(15,"form",13),t.nrm(16,"dx-number-box",14),t.j41(17,"div",15)(18,"dx-button",16),t.bIt("onClick",function(){return t.eBV(i),t.Njj(n.popupVisible=!1)}),t.k0s(),t.j41(19,"dx-button",17),t.bIt("onClick",function(){return t.eBV(i),t.Njj(n.applyBulkAdjustment())}),t.k0s()()()(),t.j41(20,"dx-popup",18),t.mxI("visibleChange",function(s){return t.eBV(i),t.DH7(n.singlePopupVisible,s)||(n.singlePopupVisible=s),t.Njj(s)}),t.j41(21,"div",19),t.DNE(22,E,4,1,"p",20),t.j41(23,"form",21),t.nrm(24,"dx-number-box",14),t.k0s(),t.j41(25,"div",15)(26,"dx-button",16),t.bIt("onClick",function(){return t.eBV(i),t.Njj(n.singlePopupVisible=!1)}),t.k0s(),t.j41(27,"dx-button",17),t.bIt("onClick",function(){return t.eBV(i),t.Njj(n.applySingleAdjustment())}),t.k0s()()()(),t.j41(28,"dx-popup",22),t.mxI("visibleChange",function(s){return t.eBV(i),t.DH7(n.historyVisible,s)||(n.historyVisible=s),t.Njj(s)}),t.j41(29,"div",23)(30,"dx-data-grid",24),t.nrm(31,"dxi-column",25)(32,"dxi-column",26)(33,"dxi-column",27)(34,"dxi-column",28)(35,"dxi-column",29)(36,"dxi-column",30),t.k0s()()()()}2&o&&(t.R7$(5),t.Y8G("dataSource",n.products)("showBorders",!0)("columnAutoWidth",!0)("selection",t.lJ4(33,w)),t.R7$(2),t.Y8G("width",200),t.R7$(),t.Y8G("width",120),t.R7$(),t.Y8G("width",120),t.R7$(),t.Y8G("width",150),t.R7$(),t.Y8G("width",220),t.R7$(3),t.R50("visible",n.popupVisible),t.Y8G("width",400)("height",250)("showTitle",!0),t.R7$(),t.Y8G("formGroup",n.bulkForm),t.R7$(),t.Y8G("showSpinButtons",!0),t.R7$(4),t.R50("visible",n.singlePopupVisible),t.Y8G("width",400)("height",250)("showTitle",!0),t.R7$(2),t.Y8G("ngIf",n.currentProduct),t.R7$(),t.Y8G("formGroup",n.singleForm),t.R7$(),t.Y8G("showSpinButtons",!0),t.R7$(4),t.R50("visible",n.historyVisible),t.Y8G("width",600)("height",400)("showTitle",!0)("title","Stock History - "+((null==n.currentProduct?null:n.currentProduct.name)||"")),t.R7$(2),t.Y8G("dataSource",n.productHistory)("showBorders",!0)("columnAutoWidth",!0),t.R7$(),t.Y8G("width",160),t.R7$(),t.Y8G("width",100),t.R7$(4),t.Y8G("width",120))},dependencies:[g.bT,l.qT,l.BC,l.cb,l.j4,l.JD,p.sjL,h.nj_,b.e,_.iI,f.EZ]})}}return a})();var x=c(5794);const j=c(7297).A;var u=c(5245);const I={provide:l.kq,useExisting:(0,t.Rfq)(()=>C),multi:!0};let C=(()=>{class a extends u.ic{_watcherHelper;_idh;instance=null;get accessKey(){return this._getOption("accessKey")}set accessKey(e){this._setOption("accessKey",e)}get activeStateEnabled(){return this._getOption("activeStateEnabled")}set activeStateEnabled(e){this._setOption("activeStateEnabled",e)}get autoResizeEnabled(){return this._getOption("autoResizeEnabled")}set autoResizeEnabled(e){this._setOption("autoResizeEnabled",e)}get disabled(){return this._getOption("disabled")}set disabled(e){this._setOption("disabled",e)}get elementAttr(){return this._getOption("elementAttr")}set elementAttr(e){this._setOption("elementAttr",e)}get focusStateEnabled(){return this._getOption("focusStateEnabled")}set focusStateEnabled(e){this._setOption("focusStateEnabled",e)}get height(){return this._getOption("height")}set height(e){this._setOption("height",e)}get hint(){return this._getOption("hint")}set hint(e){this._setOption("hint",e)}get hoverStateEnabled(){return this._getOption("hoverStateEnabled")}set hoverStateEnabled(e){this._setOption("hoverStateEnabled",e)}get inputAttr(){return this._getOption("inputAttr")}set inputAttr(e){this._setOption("inputAttr",e)}get isDirty(){return this._getOption("isDirty")}set isDirty(e){this._setOption("isDirty",e)}get isValid(){return this._getOption("isValid")}set isValid(e){this._setOption("isValid",e)}get label(){return this._getOption("label")}set label(e){this._setOption("label",e)}get labelMode(){return this._getOption("labelMode")}set labelMode(e){this._setOption("labelMode",e)}get maxHeight(){return this._getOption("maxHeight")}set maxHeight(e){this._setOption("maxHeight",e)}get maxLength(){return this._getOption("maxLength")}set maxLength(e){this._setOption("maxLength",e)}get minHeight(){return this._getOption("minHeight")}set minHeight(e){this._setOption("minHeight",e)}get name(){return this._getOption("name")}set name(e){this._setOption("name",e)}get placeholder(){return this._getOption("placeholder")}set placeholder(e){this._setOption("placeholder",e)}get readOnly(){return this._getOption("readOnly")}set readOnly(e){this._setOption("readOnly",e)}get rtlEnabled(){return this._getOption("rtlEnabled")}set rtlEnabled(e){this._setOption("rtlEnabled",e)}get spellcheck(){return this._getOption("spellcheck")}set spellcheck(e){this._setOption("spellcheck",e)}get stylingMode(){return this._getOption("stylingMode")}set stylingMode(e){this._setOption("stylingMode",e)}get tabIndex(){return this._getOption("tabIndex")}set tabIndex(e){this._setOption("tabIndex",e)}get text(){return this._getOption("text")}set text(e){this._setOption("text",e)}get validationError(){return this._getOption("validationError")}set validationError(e){this._setOption("validationError",e)}get validationErrors(){return this._getOption("validationErrors")}set validationErrors(e){this._setOption("validationErrors",e)}get validationMessageMode(){return this._getOption("validationMessageMode")}set validationMessageMode(e){this._setOption("validationMessageMode",e)}get validationMessagePosition(){return this._getOption("validationMessagePosition")}set validationMessagePosition(e){this._setOption("validationMessagePosition",e)}get validationStatus(){return this._getOption("validationStatus")}set validationStatus(e){this._setOption("validationStatus",e)}get value(){return this._getOption("value")}set value(e){this._setOption("value",e)}get valueChangeEvent(){return this._getOption("valueChangeEvent")}set valueChangeEvent(e){this._setOption("valueChangeEvent",e)}get visible(){return this._getOption("visible")}set visible(e){this._setOption("visible",e)}get width(){return this._getOption("width")}set width(e){this._setOption("width",e)}onChange;onContentReady;onCopy;onCut;onDisposing;onEnterKey;onFocusIn;onFocusOut;onInitialized;onInput;onKeyDown;onKeyUp;onOptionChanged;onPaste;onValueChanged;accessKeyChange;activeStateEnabledChange;autoResizeEnabledChange;disabledChange;elementAttrChange;focusStateEnabledChange;heightChange;hintChange;hoverStateEnabledChange;inputAttrChange;isDirtyChange;isValidChange;labelChange;labelModeChange;maxHeightChange;maxLengthChange;minHeightChange;nameChange;placeholderChange;readOnlyChange;rtlEnabledChange;spellcheckChange;stylingModeChange;tabIndexChange;textChange;validationErrorChange;validationErrorsChange;validationMessageModeChange;validationMessagePositionChange;validationStatusChange;valueChange;valueChangeEventChange;visibleChange;widthChange;onBlur;change(e){}touched=e=>{};constructor(e,o,n,i,r,s,at,rt){super(e,o,n,i,at,rt),this._watcherHelper=i,this._idh=r,this._createEventEmitters([{subscribe:"change",emit:"onChange"},{subscribe:"contentReady",emit:"onContentReady"},{subscribe:"copy",emit:"onCopy"},{subscribe:"cut",emit:"onCut"},{subscribe:"disposing",emit:"onDisposing"},{subscribe:"enterKey",emit:"onEnterKey"},{subscribe:"focusIn",emit:"onFocusIn"},{subscribe:"focusOut",emit:"onFocusOut"},{subscribe:"initialized",emit:"onInitialized"},{subscribe:"input",emit:"onInput"},{subscribe:"keyDown",emit:"onKeyDown"},{subscribe:"keyUp",emit:"onKeyUp"},{subscribe:"optionChanged",emit:"onOptionChanged"},{subscribe:"paste",emit:"onPaste"},{subscribe:"valueChanged",emit:"onValueChanged"},{emit:"accessKeyChange"},{emit:"activeStateEnabledChange"},{emit:"autoResizeEnabledChange"},{emit:"disabledChange"},{emit:"elementAttrChange"},{emit:"focusStateEnabledChange"},{emit:"heightChange"},{emit:"hintChange"},{emit:"hoverStateEnabledChange"},{emit:"inputAttrChange"},{emit:"isDirtyChange"},{emit:"isValidChange"},{emit:"labelChange"},{emit:"labelModeChange"},{emit:"maxHeightChange"},{emit:"maxLengthChange"},{emit:"minHeightChange"},{emit:"nameChange"},{emit:"placeholderChange"},{emit:"readOnlyChange"},{emit:"rtlEnabledChange"},{emit:"spellcheckChange"},{emit:"stylingModeChange"},{emit:"tabIndexChange"},{emit:"textChange"},{emit:"validationErrorChange"},{emit:"validationErrorsChange"},{emit:"validationMessageModeChange"},{emit:"validationMessagePositionChange"},{emit:"validationStatusChange"},{emit:"valueChange"},{emit:"valueChangeEventChange"},{emit:"visibleChange"},{emit:"widthChange"},{emit:"onBlur"}]),this._idh.setHost(this),s.setHost(this)}_createInstance(e,o){return new j(e,o)}writeValue(e){this.eventHelper.lockedValueChangeEvent=!0,this.value=e,this.eventHelper.lockedValueChangeEvent=!1}setDisabledState(e){this.disabled=e}registerOnChange(e){this.change=e}registerOnTouched(e){this.touched=e}_createWidget(e){super._createWidget(e),this.instance.on("focusOut",o=>{this.eventHelper.fireNgEvent("onBlur",[o])})}ngOnDestroy(){this._destroyWidget()}ngOnChanges(e){super.ngOnChanges(e),this.setupChanges("validationErrors",e)}setupChanges(e,o){e in this._optionsToUpdate||this._idh.setup(e,o)}ngDoCheck(){this._idh.doCheck("validationErrors"),this._watcherHelper.checkWatchers(),super.ngDoCheck(),super.clearChangedOptions()}_setOption(e,o){let n=this._idh.setupSingle(e,o),i=null!==this._idh.getChanges(e,o);(n||i)&&super._setOption(e,o)}static \u0275fac=function(o){return new(o||a)(t.rXU(t.aKT),t.rXU(t.SKi),t.rXU(u.zF),t.rXU(u.jS),t.rXU(u.$M),t.rXU(u.fH),t.rXU(t.pJN),t.rXU(t.Agw))};static \u0275cmp=t.VBU({type:a,selectors:[["dx-text-area"]],hostAttrs:["ngSkipHydration","true"],hostBindings:function(o,n){1&o&&t.bIt("valueChange",function(r){return n.change(r)})("onBlur",function(r){return n.touched(r)})},inputs:{accessKey:"accessKey",activeStateEnabled:"activeStateEnabled",autoResizeEnabled:"autoResizeEnabled",disabled:"disabled",elementAttr:"elementAttr",focusStateEnabled:"focusStateEnabled",height:"height",hint:"hint",hoverStateEnabled:"hoverStateEnabled",inputAttr:"inputAttr",isDirty:"isDirty",isValid:"isValid",label:"label",labelMode:"labelMode",maxHeight:"maxHeight",maxLength:"maxLength",minHeight:"minHeight",name:"name",placeholder:"placeholder",readOnly:"readOnly",rtlEnabled:"rtlEnabled",spellcheck:"spellcheck",stylingMode:"stylingMode",tabIndex:"tabIndex",text:"text",validationError:"validationError",validationErrors:"validationErrors",validationMessageMode:"validationMessageMode",validationMessagePosition:"validationMessagePosition",validationStatus:"validationStatus",value:"value",valueChangeEvent:"valueChangeEvent",visible:"visible",width:"width"},outputs:{onChange:"onChange",onContentReady:"onContentReady",onCopy:"onCopy",onCut:"onCut",onDisposing:"onDisposing",onEnterKey:"onEnterKey",onFocusIn:"onFocusIn",onFocusOut:"onFocusOut",onInitialized:"onInitialized",onInput:"onInput",onKeyDown:"onKeyDown",onKeyUp:"onKeyUp",onOptionChanged:"onOptionChanged",onPaste:"onPaste",onValueChanged:"onValueChanged",accessKeyChange:"accessKeyChange",activeStateEnabledChange:"activeStateEnabledChange",autoResizeEnabledChange:"autoResizeEnabledChange",disabledChange:"disabledChange",elementAttrChange:"elementAttrChange",focusStateEnabledChange:"focusStateEnabledChange",heightChange:"heightChange",hintChange:"hintChange",hoverStateEnabledChange:"hoverStateEnabledChange",inputAttrChange:"inputAttrChange",isDirtyChange:"isDirtyChange",isValidChange:"isValidChange",labelChange:"labelChange",labelModeChange:"labelModeChange",maxHeightChange:"maxHeightChange",maxLengthChange:"maxLengthChange",minHeightChange:"minHeightChange",nameChange:"nameChange",placeholderChange:"placeholderChange",readOnlyChange:"readOnlyChange",rtlEnabledChange:"rtlEnabledChange",spellcheckChange:"spellcheckChange",stylingModeChange:"stylingModeChange",tabIndexChange:"tabIndexChange",textChange:"textChange",validationErrorChange:"validationErrorChange",validationErrorsChange:"validationErrorsChange",validationMessageModeChange:"validationMessageModeChange",validationMessagePositionChange:"validationMessagePositionChange",validationStatusChange:"validationStatusChange",valueChange:"valueChange",valueChangeEventChange:"valueChangeEventChange",visibleChange:"visibleChange",widthChange:"widthChange",onBlur:"onBlur"},standalone:!0,features:[t.Jv_([u.zF,u.jS,I,u.fH,u.$M]),t.Vt3,t.OA$,t.aNF],decls:0,vars:0,template:function(o,n){},dependencies:[u.p_],encapsulation:2})}return a})(),F=(()=>{class a{static \u0275fac=function(o){return new(o||a)};static \u0275mod=t.$C({type:a});static \u0275inj=t.G2t({imports:[C,u.p_,u.xZ,u.xZ]})}return a})();const R=()=>({pageSize:10}),T=()=>({visible:!0,width:"100%",placeholder:"Search..."}),V=()=>({mode:"standard",showScrollbar:"onScroll"}),G=(a,d)=>({enabled:a,disabled:d});function B(a,d){if(1&a&&(t.j41(0,"div")(1,"span",56),t.EFF(2),t.k0s()()),2&a){const e=d.$implicit;t.R7$(),t.Y8G("ngClass",t.l_i(2,G,e.data.is_enabled,!e.data.is_enabled)),t.R7$(),t.SpI(" ",e.data.is_enabled?"Enabled":"Disabled"," ")}}function A(a,d){if(1&a){const e=t.RV6();t.j41(0,"div")(1,"div",57)(2,"dx-button",58),t.bIt("onClick",function(){const n=t.eBV(e).$implicit,i=t.XpG();return t.Njj(i.editProduct(n.data))}),t.k0s(),t.j41(3,"dx-button",59),t.bIt("onClick",function(){const n=t.eBV(e).$implicit,i=t.XpG();return t.Njj(i.addStock(n.data))}),t.k0s(),t.j41(4,"dx-button",60),t.bIt("onClick",function(){const n=t.eBV(e).$implicit,i=t.XpG();return t.Njj(i.viewStockHistory(n.data))}),t.k0s(),t.j41(5,"dx-button",61),t.bIt("onClick",function(){const n=t.eBV(e).$implicit,i=t.XpG();return t.Njj(i.deleteProduct(n.data))}),t.k0s()()()}}function H(a,d){1&a&&(t.j41(0,"div",62)(1,"p"),t.EFF(2,"Loading products..."),t.k0s()())}function N(a,d){if(1&a&&(t.j41(0,"option",30),t.EFF(1),t.k0s()),2&a){const e=d.$implicit;t.Y8G("value",e.id),t.R7$(),t.JRh(e.name)}}function D(a,d){if(1&a&&(t.j41(0,"option",30),t.EFF(1),t.k0s()),2&a){const e=d.$implicit;t.Y8G("value",e.id),t.R7$(),t.JRh(e.name)}}function $(a,d){if(1&a){const e=t.RV6();t.j41(0,"div",63),t.nrm(1,"img",64),t.j41(2,"button",65),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.removeImage())}),t.EFF(3,"\u2715"),t.k0s()()}if(2&a){const e=t.XpG();t.R7$(),t.Y8G("src",e.previewImage,t.B4B)}}function Y(a,d){if(1&a&&(t.j41(0,"div")(1,"dx-data-grid",66),t.nrm(2,"dxi-column",67)(3,"dxi-column",68)(4,"dxi-column",69)(5,"dxi-column",70)(6,"dxi-column",71),t.k0s()()),2&a){const e=t.XpG();t.R7$(),t.Y8G("dataSource",e.selectedProductHistory)("showBorders",!0)("columnAutoWidth",!0)}}function L(a,d){if(1&a&&(t.j41(0,"div",72),t.EFF(1),t.k0s()),2&a){const e=t.XpG();t.R7$(),t.SpI("No stock adjustment history for ",e.selectedProductName,"")}}let U=(()=>{class a{constructor(e,o,n){this.inventoryService=e,this.toastr=o,this.fb=n,this.products=[],this.categories=[],this.units=[],this.showProductFormPopup=!1,this.showAddStockPopup=!1,this.showHistoryPopup=!1,this.selectedProduct=null,this.selectedProductId=null,this.selectedProductName="",this.selectedProductHistory=[],this.selectedPurchaseHistory=[],this.isEditing=!1,this.isLowStockView=!1,this.loading=!1,this.screenWidth=window.innerWidth,this.screenHeight=window.innerHeight,this.calculateProfitMargin=i=>i.unit_price&&i.buying_price?i.unit_price-i.buying_price:0,this.calculateProfitPercentage=i=>i.unit_price&&i.buying_price&&i.buying_price>0?(i.unit_price-i.buying_price)/i.buying_price*100:0,this.getStatusLabel=i=>i.is_enabled?"Enabled":"Disabled",this.previewImage=null,this.selectedFile=null}ngOnInit(){window.addEventListener("resize",()=>{this.screenWidth=window.innerWidth,this.screenHeight=window.innerHeight}),this.initForms(),this.loadProducts(),this.loadCategories(),this.loadUnits()}initForms(){this.form=this.fb.group({name:["",l.k0.required],sku:[""],category_id:[null],description:[""],unit_id:[null],buying_price:[0],unit_price:[0,l.k0.required],stock_quantity:[0,l.k0.required],low_stock_threshold:[10],is_enabled:[!0],image:[null]}),this.addStockForm=this.fb.group({stock_quantity:[1,[l.k0.required,l.k0.min(1)]],buying_price:[0,[l.k0.required,l.k0.min(0)]],reason:["",l.k0.required]})}openProductFormPopup(e){e?(this.isEditing=!0,this.selectedProductId=e.id,this.form.patchValue(e)):this.resetForm(),this.showProductFormPopup=!0}closeProductFormPopup(){this.showProductFormPopup=!1,this.resetForm()}resetForm(){this.form.reset({name:"",sku:"",category_id:null,description:"",unit_id:null,buying_price:0,unit_price:0,stock_quantity:0,low_stock_threshold:10,is_enabled:!0}),this.isEditing=!1,this.selectedProductId=null}onSubmit(){if(this.form.invalid)return void this.toastr.warning("Please fill all required fields before submitting");this.loading=!0;const e=new FormData;Object.keys(this.form.value).forEach(n=>{const i=this.form.value[n];null!=i&&e.append(n,i)}),(this.isEditing&&this.selectedProductId?this.inventoryService.update(this.selectedProductId,e):this.inventoryService.create(e)).subscribe({next:()=>{this.toastr.success(`Product ${this.isEditing?"updated":"created"} successfully`),this.closeProductFormPopup(),this.loadProducts(),this.removeImage()},error:n=>this.handleError(n,`Failed to ${this.isEditing?"update":"create"} product`),complete:()=>this.loading=!1})}loadProducts(){this.loading=!0,this.inventoryService.list().subscribe({next:e=>this.products=e,error:e=>this.handleError(e,"Failed to load products"),complete:()=>this.loading=!1})}loadCategories(){this.inventoryService.getCategories().subscribe({next:e=>this.categories=e,error:e=>this.handleError(e,"Failed to load categories")})}loadUnits(){this.inventoryService.getUnits().subscribe({next:e=>this.units=e,error:e=>this.handleError(e,"Failed to load units")})}addStock(e){this.selectedProduct=e,this.addStockForm.reset({stock_quantity:1,buying_price:e.buying_price||0,reason:"New Stock Received"}),this.showAddStockPopup=!0}editProduct(e){this.openProductFormPopup(e)}closeAddStockPopup(){this.showAddStockPopup=!1,this.selectedProduct=null}confirmAddStock(){if(!this.selectedProduct||this.addStockForm.invalid)return void this.toastr.warning("Please fill all required fields correctly");const{stock_quantity:e,buying_price:o,reason:n}=this.addStockForm.value,i={quantity:e,buying_price:o,reason:n,user:"Admin"},r=this.selectedProduct.id;this.loading=!0,this.inventoryService.addNewStock(r,i).subscribe({next:s=>{"success"===s.status||s.success?(this.toastr.success(`Stock added for ${this.selectedProduct?.name}`),this.closeAddStockPopup(),this.loadProducts()):this.toastr.error(s.message||"Failed to add stock")},error:s=>this.handleError(s,"Error while adding stock"),complete:()=>this.loading=!1})}toggleLowStock(){this.loading=!0,(this.isLowStockView?this.inventoryService.list():this.inventoryService.lowStockProducts()).subscribe({next:o=>{this.products=o,this.isLowStockView=!this.isLowStockView,this.dataGrid?.instance?.clearFilter(),this.dataGrid?.instance?.clearSorting(),this.dataGrid?.instance?.searchByText("")},error:()=>this.toastr.error("Failed to load products"),complete:()=>this.loading=!1})}viewStockHistory(e){this.selectedProductName=e.name,this.selectedProductHistory=[],this.selectedPurchaseHistory=[],this.showHistoryPopup=!0,this.inventoryService.getStockHistory(e.id).subscribe({next:o=>this.selectedProductHistory=o,error:()=>this.toastr.error("Failed to load stock history")}),this.inventoryService.getPurchaseHistory(e.id).subscribe({next:o=>this.selectedPurchaseHistory=o,error:()=>console.warn("No purchase history found")})}closeHistoryPopup(){this.showHistoryPopup=!1}onRowPrepared(e){"data"===e.rowType&&e.data.stock_quantity<e.data.low_stock_threshold&&e.rowElement.classList.add("low-stock-row")}onCellPrepared(e){"data"===e.rowType&&"stock_quantity"===e.column.dataField&&(e.data.stock_quantity<e.data.low_stock_threshold?(e.cellElement.style.backgroundColor="#ffe5e5",e.cellElement.style.color="#b91c1c"):(e.cellElement.style.backgroundColor="#daf3dd",e.cellElement.style.color="#112e08"),e.cellElement.style.fontWeight="600")}deleteProduct(e){confirm(`Are you sure you want to delete ${e.name}?`)&&this.inventoryService.delete(e.id).subscribe({next:()=>{this.toastr.success(`${e.name} deleted successfully`),this.loadProducts()},error:o=>{console.error("Delete failed:",o),this.toastr.error("Failed to delete product")}})}onImageSelected(e){const o=e.target?.files?.[0]??null;if(!o)return;if(!o.type.startsWith("image/"))return void this.toastr.error("Please select a valid image file");if(o.size/1024/1024>3)return void this.toastr.error("Image too large. Max 3MB");this.selectedFile=o,this.form.patchValue({image:o}),this.form.get("image")?.updateValueAndValidity();const i=new FileReader;i.onload=()=>{this.previewImage=i.result},i.readAsDataURL(o)}removeImage(){this.selectedFile=null,this.previewImage=null}handleError(e,o="An unexpected error occurred"){if(console.error(o,e),e?.error?.errors){const n=Object.values(e.error.errors).flat().join("\n");this.toastr.error(n,"Validation Error")}else e?.error?.message?this.toastr.error(e.error.message,"Error"):"string"==typeof e?this.toastr.error(e,"Error"):this.toastr.error(o);this.loading=!1}static{this.\u0275fac=function(o){return new(o||a)(t.rXU(m.c),t.rXU(x.tw),t.rXU(l.ok))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-inventory-management"]],viewQuery:function(o,n){if(1&o&&t.GBs(p.sjL,5),2&o){let i;t.mGM(i=t.lsd())&&(n.dataGrid=i.first)}},decls:115,vars:58,consts:[["dataGrid",""],["noHistory",""],[1,"inventory-container"],[1,"page-title"],[1,"toolbar"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-warning",3,"click"],[1,"table-card","table-responsive"],[3,"onRowPrepared","onCellPrepared","dataSource","showBorders","columnAutoWidth","hoverStateEnabled","rowAlternationEnabled","allowColumnResizing","columnHidingEnabled","paging","searchPanel","scrolling","wordWrapEnabled","showColumnLines","showRowLines"],["mode","row",3,"allowUpdating","allowDeleting","allowAdding"],["dataField","name","caption","Product Name"],["dataField","category_name","caption","Category"],["dataField","unit_name","caption","Unit"],["dataField","buying_price","caption","Buying Price","dataType","number","format","#,##0.00"],["dataField","unit_price","caption","Unit Price","dataType","number","format","#,##0.00"],["caption","Profit Margin (KSh)","format","#,##0.00",3,"calculateCellValue"],["caption","Profit %","format","#,##0.##",3,"calculateCellValue"],["dataField","stock_quantity","caption","Stock Quantity"],["dataField","low_stock_threshold","caption","Low Stock Threshold"],["caption","Status","cellTemplate","statusCell"],[4,"dxTemplate","dxTemplateOf"],["caption","Actions","cellTemplate","actionButtons"],["class","loading-text",4,"ngIf"],["closeOnOutsideClick","true",3,"onHiding","visible","dragEnabled","width","height","title"],[1,"popup-content"],[1,"product-form",3,"ngSubmit","formGroup"],[1,"form-group"],["type","text","formControlName","name","placeholder","Enter name",1,"form-control"],["type","text","formControlName","sku","placeholder","Enter SKU",1,"form-control"],["formControlName","category_id",1,"form-select"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["formControlName","unit_id",1,"form-select"],["type","number","formControlName","buying_price","placeholder","Enter buying price",1,"form-control"],["type","number","formControlName","unit_price","placeholder","Enter unit price",1,"form-control"],["type","number","formControlName","stock_quantity","min","0",1,"form-control"],["type","number","formControlName","low_stock_threshold","min","0",1,"form-control"],["formControlName","is_enabled",1,"form-select"],[3,"ngValue"],["formControlName","description","placeholder","Enter description",1,"form-control"],[1,"form-group","image-upload"],["for","productImage"],["type","file","id","productImage","accept","image/*",3,"change"],["class","image-preview",4,"ngIf"],[1,"form-actions"],["text","Cancel","type","normal",3,"onClick"],["type","success",3,"text","useSubmitBehavior","disabled"],["closeOnOutsideClick","true","title","Add Stock",3,"onHiding","visible","dragEnabled","width","height"],[1,"readonly-field"],["formControlName","stock_quantity","placeholder","Enter quantity",3,"min","showSpinButtons"],["formControlName","buying_price","placeholder","Enter buying price","format","#,##0.00",3,"min","showSpinButtons"],["formControlName","reason","placeholder","Enter reason for adding stock"],["text","Cancel","type","normal","stylingMode","outlined","icon","close",3,"onClick"],["text","Add Stock","type","success","stylingMode","contained","icon","check",3,"useSubmitBehavior"],["closeOnOutsideClick","true","title","Stock Adjustment History",3,"onHiding","visible","dragEnabled","width","height"],[4,"ngIf","ngIfElse"],[1,"status-badge",3,"ngClass"],[1,"action-buttons"],["text","Edit","icon","edit","type","normal","stylingMode","outlined",1,"btn-edit",3,"onClick"],["text","Add Stock","icon","add","type","default","stylingMode","outlined",1,"btn-add-stock",3,"onClick"],["text","History","icon","clock","type","normal","stylingMode","outlined",1,"btn-history",3,"onClick"],["text","Delete","icon","trash","type","danger","stylingMode","outlined",1,"btn-delete",3,"onClick"],[1,"loading-text"],[1,"image-preview"],["alt","Product Preview",3,"src"],["type","button","title","Remove image",1,"remove-btn",3,"click"],[3,"dataSource","showBorders","columnAutoWidth"],["dataField","created_at","caption","Date"],["dataField","change","caption","Change"],["dataField","new_quantity","caption","New Quantity"],["dataField","reason","caption","Reason"],["dataField","adjusted_by","caption","Adjusted By"],[1,"no-history"]],template:function(o,n){if(1&o){const i=t.RV6();t.j41(0,"div",2)(1,"h2",3),t.EFF(2,"Inventory Management"),t.k0s(),t.j41(3,"div",4)(4,"button",5),t.bIt("click",function(){return t.eBV(i),t.Njj(n.openProductFormPopup())}),t.EFF(5,"Add Product"),t.k0s(),t.j41(6,"button",6),t.bIt("click",function(){return t.eBV(i),t.Njj(n.toggleLowStock())}),t.EFF(7),t.k0s()(),t.j41(8,"div",7)(9,"dx-data-grid",8,0),t.bIt("onRowPrepared",function(s){return t.eBV(i),t.Njj(n.onRowPrepared(s))})("onCellPrepared",function(s){return t.eBV(i),t.Njj(n.onCellPrepared(s))}),t.nrm(11,"dxo-editing",9)(12,"dxi-column",10)(13,"dxi-column",11)(14,"dxi-column",12)(15,"dxi-column",13)(16,"dxi-column",14)(17,"dxi-column",15)(18,"dxi-column",16)(19,"dxi-column",17)(20,"dxi-column",18)(21,"dxi-column",19),t.DNE(22,B,3,5,"div",20),t.nrm(23,"dxi-column",21),t.DNE(24,A,6,0,"div",20),t.k0s()(),t.DNE(25,H,3,0,"div",22),t.k0s(),t.j41(26,"dx-popup",23),t.bIt("onHiding",function(){return t.eBV(i),t.Njj(n.closeProductFormPopup())}),t.j41(27,"div",24)(28,"form",25),t.bIt("ngSubmit",function(){return t.eBV(i),t.Njj(n.onSubmit())}),t.j41(29,"div",26)(30,"label"),t.EFF(31,"Product Name"),t.k0s(),t.nrm(32,"input",27),t.k0s(),t.j41(33,"div",26)(34,"label"),t.EFF(35,"SKU"),t.k0s(),t.nrm(36,"input",28),t.k0s(),t.j41(37,"div",26)(38,"label"),t.EFF(39,"Category"),t.k0s(),t.j41(40,"select",29)(41,"option",30),t.EFF(42,"Select Category"),t.k0s(),t.DNE(43,N,2,2,"option",31),t.k0s()(),t.j41(44,"div",26)(45,"label"),t.EFF(46,"Unit of Measure"),t.k0s(),t.j41(47,"select",32)(48,"option",30),t.EFF(49,"Select Unit"),t.k0s(),t.DNE(50,D,2,2,"option",31),t.k0s()(),t.j41(51,"div",26)(52,"label"),t.EFF(53,"Buying Price"),t.k0s(),t.nrm(54,"input",33),t.k0s(),t.j41(55,"div",26)(56,"label"),t.EFF(57,"Unit Price"),t.k0s(),t.nrm(58,"input",34),t.k0s(),t.j41(59,"div",26)(60,"label"),t.EFF(61,"Stock Quantity"),t.k0s(),t.nrm(62,"input",35),t.k0s(),t.j41(63,"div",26)(64,"label"),t.EFF(65,"Low Stock Threshold"),t.k0s(),t.nrm(66,"input",36),t.k0s(),t.j41(67,"div",26)(68,"label"),t.EFF(69,"Status"),t.k0s(),t.j41(70,"select",37)(71,"option",38),t.EFF(72,"Enabled"),t.k0s(),t.j41(73,"option",38),t.EFF(74,"Disabled"),t.k0s()()(),t.j41(75,"div",26)(76,"label"),t.EFF(77,"Description"),t.k0s(),t.nrm(78,"textarea",39),t.k0s(),t.j41(79,"div",40)(80,"label",41),t.EFF(81,"Product Image"),t.k0s(),t.j41(82,"input",42),t.bIt("change",function(s){return t.eBV(i),t.Njj(n.onImageSelected(s))}),t.k0s(),t.DNE(83,$,4,1,"div",43),t.k0s(),t.j41(84,"div",44)(85,"dx-button",45),t.bIt("onClick",function(){return t.eBV(i),t.Njj(n.closeProductFormPopup())}),t.k0s(),t.nrm(86,"dx-button",46),t.k0s()()()(),t.j41(87,"dx-popup",47),t.bIt("onHiding",function(){return t.eBV(i),t.Njj(n.closeAddStockPopup())}),t.j41(88,"div",24)(89,"form",25),t.bIt("ngSubmit",function(){return t.eBV(i),t.Njj(n.confirmAddStock())}),t.j41(90,"div",26)(91,"label"),t.EFF(92,"Product"),t.k0s(),t.j41(93,"div",48),t.EFF(94),t.k0s()(),t.j41(95,"div",26)(96,"label"),t.EFF(97,"Quantity to Add"),t.k0s(),t.nrm(98,"dx-number-box",49),t.k0s(),t.j41(99,"div",26)(100,"label"),t.EFF(101,"Buying Price per Unit"),t.k0s(),t.nrm(102,"dx-number-box",50),t.k0s(),t.j41(103,"div",26)(104,"label"),t.EFF(105,"Reason"),t.k0s(),t.nrm(106,"dx-text-area",51),t.k0s(),t.j41(107,"div",44)(108,"dx-button",52),t.bIt("onClick",function(){return t.eBV(i),t.Njj(n.closeAddStockPopup())}),t.k0s(),t.nrm(109,"dx-button",53),t.k0s()()()(),t.j41(110,"dx-popup",54),t.bIt("onHiding",function(){return t.eBV(i),t.Njj(n.closeHistoryPopup())}),t.j41(111,"div",24),t.DNE(112,Y,7,3,"div",55)(113,L,2,1,"ng-template",null,1,t.C5r),t.k0s()()}if(2&o){const i=t.sdS(114);t.R7$(7),t.SpI(" ",n.isLowStockView?"Show All Products":"Show Low Stock"," "),t.R7$(2),t.Y8G("dataSource",n.products)("showBorders",!0)("columnAutoWidth",!0)("hoverStateEnabled",!0)("rowAlternationEnabled",!0)("allowColumnResizing",!0)("columnHidingEnabled",!0)("paging",t.lJ4(55,R))("searchPanel",t.lJ4(56,T))("scrolling",t.lJ4(57,V))("wordWrapEnabled",!0)("showColumnLines",!0)("showRowLines",!0),t.R7$(2),t.Y8G("allowUpdating",!1)("allowDeleting",!1)("allowAdding",!1),t.R7$(6),t.Y8G("calculateCellValue",n.calculateProfitMargin),t.R7$(),t.Y8G("calculateCellValue",n.calculateProfitPercentage),t.R7$(4),t.Y8G("dxTemplateOf","statusCell"),t.R7$(2),t.Y8G("dxTemplateOf","actionButtons"),t.R7$(),t.Y8G("ngIf",n.loading),t.R7$(),t.Y8G("visible",n.showProductFormPopup)("dragEnabled",!0)("width",n.screenWidth<768?"90%":600)("height",n.screenHeight<600?"90%":600)("title",n.isEditing?"Edit Product":"Add Product"),t.R7$(2),t.Y8G("formGroup",n.form),t.R7$(13),t.Y8G("value",null),t.R7$(2),t.Y8G("ngForOf",n.categories),t.R7$(5),t.Y8G("value",null),t.R7$(2),t.Y8G("ngForOf",n.units),t.R7$(21),t.Y8G("ngValue",!0),t.R7$(2),t.Y8G("ngValue",!1),t.R7$(10),t.Y8G("ngIf",n.previewImage),t.R7$(3),t.Y8G("text",n.isEditing?"Update":"Add")("useSubmitBehavior",!0)("disabled",n.loading),t.R7$(),t.Y8G("visible",n.showAddStockPopup)("dragEnabled",!0)("width",n.screenWidth<768?"90%":420)("height",n.screenHeight<600?"90%":460),t.R7$(2),t.Y8G("formGroup",n.addStockForm),t.R7$(5),t.JRh(null==n.selectedProduct?null:n.selectedProduct.name),t.R7$(4),t.Y8G("min",1)("showSpinButtons",!0),t.R7$(4),t.Y8G("min",0)("showSpinButtons",!0),t.R7$(7),t.Y8G("useSubmitBehavior",!0),t.R7$(),t.Y8G("visible",n.showHistoryPopup)("dragEnabled",!0)("width",n.screenWidth<768?"90%":700)("height",n.screenHeight<600?"90%":500),t.R7$(2),t.Y8G("ngIf",n.selectedProductHistory.length)("ngIfElse",i)}},dependencies:[g.YU,g.Sq,g.bT,l.qT,l.xH,l.y7,l.me,l.Q0,l.wz,l.BC,l.cb,l.VZ,l.j4,l.JD,p.sjL,h.nj_,h.$Xk,u.eC,b.e,_.iI,f.EZ,C],styles:[".inventory-container[_ngcontent-%COMP%]{min-height:100vh;background:linear-gradient(to bottom right,#f8fafc,#eef2ff);font-family:Segoe UI,Roboto,Arial,sans-serif;color:#2d2d2d;padding:24px;transition:background .3s ease,color .3s ease}.low-stock-row[_ngcontent-%COMP%]{background-color:#fff7e6!important;border-left:4px solid #f59e0b}.critical-stock-row[_ngcontent-%COMP%]{background-color:#fee2e2!important;border-left:4px solid #dc2626!important;color:#991b1b!important;font-weight:600}.page-title[_ngcontent-%COMP%]{font-size:30px;font-weight:700;color:#1e1e2d;text-align:center;margin-bottom:25px;letter-spacing:-.3px}.popup-close-btn[_ngcontent-%COMP%]{position:absolute;top:12px;right:12px;border:none;background:transparent;font-size:22px;cursor:pointer;color:#555;font-weight:700;transition:all .2s ease}.popup-close-btn[_ngcontent-%COMP%]:hover{color:#ef4444;transform:scale(1.1)}.toolbar[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;margin-bottom:15px;gap:10px;padding:12px 18px;background:#fff;border-radius:12px;box-shadow:0 2px 8px #0000000a}.toolbar[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:20px;font-weight:600;margin:0;color:#333}.btn[_ngcontent-%COMP%]{border:none;border-radius:10px;padding:10px 20px;cursor:pointer;font-weight:600;transition:all .25s ease}.btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 3px 8px #0000001a}.btn-primary[_ngcontent-%COMP%]{background-color:#4f46e5;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#4338ca}.btn-warning[_ngcontent-%COMP%]{background-color:#f59e0b;color:#fff}.btn-warning[_ngcontent-%COMP%]:hover{background-color:#d97706}.table-card[_ngcontent-%COMP%]{background:#fff;border-radius:14px;box-shadow:0 3px 15px #0000000f;padding:22px;transition:box-shadow .3s,transform .2s;overflow-x:auto}.table-card[_ngcontent-%COMP%]:hover{box-shadow:0 6px 22px #0000001a;transform:translateY(-2px)}.action-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px;justify-content:center}.product-form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px;background:#fff;padding:24px;border-radius:14px;box-shadow:0 4px 18px #0000000d}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;font-size:14px;color:#444;margin-bottom:6px}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:1px solid #d1d5db;border-radius:10px;padding:10px 12px;font-size:14px;transition:all .2s ease}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus, .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]:focus{border-color:#4f46e5;outline:none;box-shadow:0 0 0 3px #4f46e51a}.form-actions[_ngcontent-%COMP%]{grid-column:1 / -1;display:flex;justify-content:flex-end;gap:10px;margin-top:10px}.loading-text[_ngcontent-%COMP%]{text-align:center;margin-top:25px;font-size:15px;color:#6b7280}.no-history[_ngcontent-%COMP%]{text-align:center;margin-top:25px;font-size:15px;color:#9ca3af}.popup-content[_ngcontent-%COMP%]{padding:20px;max-height:90vh;overflow-y:auto;border-radius:12px;background:#fff}.center[_ngcontent-%COMP%]{text-align:center;margin-bottom:15px}.dark-mode[_ngcontent-%COMP%]   .inventory-container[_ngcontent-%COMP%]{background:linear-gradient(to bottom right,#1e1e2e,#2a2a3b);color:#e2e8f0}.dark-mode[_ngcontent-%COMP%]   .toolbar[_ngcontent-%COMP%], .dark-mode[_ngcontent-%COMP%]   .table-card[_ngcontent-%COMP%], .dark-mode[_ngcontent-%COMP%]   .product-form[_ngcontent-%COMP%], .dark-mode[_ngcontent-%COMP%]   .popup-content[_ngcontent-%COMP%]{background:#2d2d3a;box-shadow:0 3px 10px #00000080}.dark-mode[_ngcontent-%COMP%]   .btn-primary[_ngcontent-%COMP%]{background-color:#6366f1}.dark-mode[_ngcontent-%COMP%]   .btn-warning[_ngcontent-%COMP%]{background-color:#fbbf24}.dark-mode[_ngcontent-%COMP%]   .low-stock-row[_ngcontent-%COMP%]{background-color:#fffbeb1a!important;border-left:4px solid #fbbf24}.dark-mode[_ngcontent-%COMP%]   .critical-stock-row[_ngcontent-%COMP%]{background-color:#ef44441a!important;border-left:4px solid #ef4444!important;color:#fca5a5!important}.low-stock-row[_ngcontent-%COMP%]{background-color:#ffe5e5!important;color:#b91c1c!important;border-left:4px solid #dc2626}.low-stock-cell[_ngcontent-%COMP%]{background-color:#ffe5e5!important;color:#b91c1c!important;font-weight:600}.action-buttons[_ngcontent-%COMP%]{display:flex;gap:8px;justify-content:center}.action-buttons[_ngcontent-%COMP%]   .dx-button[_ngcontent-%COMP%]{border-radius:8px!important;font-weight:600;transition:all .25s ease}.btn-edit[_ngcontent-%COMP%]   .dx-button-content[_ngcontent-%COMP%]{color:#2563eb!important;border:1px solid #2563eb!important}.btn-edit[_ngcontent-%COMP%]:hover   .dx-button-content[_ngcontent-%COMP%]{background-color:#2563eb!important;color:#fff!important}.btn-add-stock[_ngcontent-%COMP%]   .dx-button-content[_ngcontent-%COMP%]{color:#16a34a!important;border:1px solid #16a34a!important}.btn-add-stock[_ngcontent-%COMP%]:hover   .dx-button-content[_ngcontent-%COMP%]{background-color:#16a34a!important;color:#fff!important}.btn-history[_ngcontent-%COMP%]   .dx-button-content[_ngcontent-%COMP%]{color:#f59e0b!important;border:1px solid #f59e0b!important}.btn-history[_ngcontent-%COMP%]:hover   .dx-button-content[_ngcontent-%COMP%]{background-color:#f59e0b!important;color:#fff!important}.btn-delete[_ngcontent-%COMP%]   .dx-button-content[_ngcontent-%COMP%]{color:#dc2626!important;border:1px solid #dc2626!important}.btn-delete[_ngcontent-%COMP%]:hover   .dx-button-content[_ngcontent-%COMP%]{background-color:#dc2626!important;color:#fff!important}element.style[_ngcontent-%COMP%]{max-width:none!important}.image-upload[_ngcontent-%COMP%]{margin-top:1rem}.image-upload[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;font-weight:600;margin-bottom:.5rem}.image-upload[_ngcontent-%COMP%]   input[type=file][_ngcontent-%COMP%]{display:block;margin-bottom:.5rem}.image-preview[_ngcontent-%COMP%]{position:relative;display:inline-block}.image-preview[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:120px;height:120px;object-fit:cover;border-radius:8px;border:1px solid #ccc}.remove-btn[_ngcontent-%COMP%]{position:absolute;top:-5px;right:-5px;background:#b91c1c;color:#fff;border:none;border-radius:50%;width:22px;height:22px;cursor:pointer;font-size:14px;line-height:1}@media (max-width: 768px){.toolbar[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch;gap:12px;text-align:center}.product-form[_ngcontent-%COMP%]{grid-template-columns:1fr;padding:18px}.table-card[_ngcontent-%COMP%]{padding:16px}.btn[_ngcontent-%COMP%]{width:100%}}"]})}}return a})();var k=c(8856);const z=()=>({pageSize:10}),X=()=>[5,10,20],K=a=>({showPageSizeSelector:!0,allowedPageSizes:a,showInfo:!0});function q(a,d){if(1&a){const e=t.RV6();t.j41(0,"dx-tab-panel",6),t.mxI("selectedItemChange",function(n){t.eBV(e);const i=t.XpG();return t.DH7(i.selectedTab,n)||(i.selectedTab=n),t.Njj(n)}),t.bIt("onItemClick",function(n){t.eBV(e);const i=t.XpG();return t.Njj(i.selectTab(n.itemData))}),t.k0s()}if(2&a){const e=t.XpG();t.Y8G("dataSource",e.tabs),t.R50("selectedItem",e.selectedTab)}}function W(a,d){1&a&&(t.j41(0,"div",7),t.EFF(1," Loading... "),t.k0s())}function J(a,d){if(1&a&&(t.j41(0,"dx-data-grid",9),t.nrm(1,"dxi-column",10)(2,"dxi-column",11)(3,"dxi-column",12)(4,"dxi-column",13)(5,"dxi-column",14),t.k0s()),2&a){const e=t.XpG(2);t.Y8G("dataSource",e.configData)("showBorders",!0)("columnAutoWidth",!0)("allowColumnResizing",!0)("columnResizingMode","widget")("paging",t.lJ4(11,z))("pager",t.eq3(13,K,t.lJ4(12,X))),t.R7$(),t.Y8G("width",70),t.R7$(3),t.Y8G("calculateCellValue",e.enabledCellValue),t.R7$(),t.Y8G("width",100)("cellTemplate","actionsTemplate")}}function Q(a,d){1&a&&(t.j41(0,"p"),t.EFF(1,"No configuration data found."),t.k0s())}function Z(a,d){if(1&a){const e=t.RV6();t.j41(0,"button",15),t.bIt("click",function(){const n=t.eBV(e).$implicit,i=t.XpG(2);return t.Njj(i.deleteItem(n.data.id))}),t.EFF(1,"Delete"),t.k0s()}}function tt(a,d){if(1&a&&(t.j41(0,"div")(1,"h3"),t.EFF(2),t.k0s(),t.DNE(3,J,6,15,"dx-data-grid",8)(4,Q,2,0,"ng-template",null,0,t.C5r)(6,Z,2,0,"ng-template",null,1,t.C5r),t.k0s()),2&a){const e=t.sdS(5),o=t.XpG();t.R7$(2),t.SpI("",o.selectedTab.displayName," Configuration"),t.R7$(),t.Y8G("ngIf",o.configData.length)("ngIfElse",e)}}const et=[{path:"",component:U,children:[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:M}]},{path:"configs",component:(()=>{class a{constructor(e){this.inventoryService=e,this.tabs=[],this.configData=[],this.loading=!1,this.enabledCellValue=o=>o.is_enabled?"Yes":"No"}ngOnInit(){this.loadTabs(),this.selectTab(this.tabs[0]),this.loadConfig(this.tabs[0].tableName)}loadTabs(){this.loading=!0,this.inventoryService.getConfigTables().subscribe({next:e=>{e.success&&(this.tabs=e.data,this.tabs.length&&this.selectTab(this.tabs[0])),this.loading=!1},error:e=>{console.error("Failed to load config tables",e),this.loading=!1}})}selectTab(e,o={}){this.selectedTab=e,this.loadConfig(e.tableName,o)}loadConfig(e,o={}){e&&(this.loading=!0,this.inventoryService.loadConfig(e,o).subscribe({next:n=>{n.success?this.configData=n.data:(this.configData=[],console.warn(n.message)),this.loading=!1},error:n=>{console.error("Error loading config",n),this.configData=[],this.loading=!1}}))}deleteItem(e){this.selectedTab&&this.inventoryService.deleteConfig(this.selectedTab.tableName,e).subscribe({next:n=>{n.success?this.configData=this.configData.filter(i=>i.id!==e):console.warn(n.message)},error:n=>console.error("Failed to delete config",n)})}static{this.\u0275fac=function(o){return new(o||a)(t.rXU(m.c))}}static{this.\u0275cmp=t.VBU({type:a,selectors:[["app-configurations"]],decls:4,vars:3,consts:[["noData",""],["actionsTemplate",""],[1,"configurations"],["displayExpr","displayName",3,"dataSource","selectedItem","selectedItemChange","onItemClick",4,"ngIf"],["class","loading",4,"ngIf"],[4,"ngIf"],["displayExpr","displayName",3,"selectedItemChange","onItemClick","dataSource","selectedItem"],[1,"loading"],[3,"dataSource","showBorders","columnAutoWidth","allowColumnResizing","columnResizingMode","paging","pager",4,"ngIf","ngIfElse"],[3,"dataSource","showBorders","columnAutoWidth","allowColumnResizing","columnResizingMode","paging","pager"],["dataField","id","caption","ID","dataType","number",3,"width"],["dataField","name","caption","Name"],["dataField","description","caption","Description"],["dataField","is_enabled","caption","Enabled",3,"calculateCellValue"],["caption","Actions",3,"width","cellTemplate"],[3,"click"]],template:function(o,n){1&o&&(t.j41(0,"div",2),t.DNE(1,q,1,2,"dx-tab-panel",3)(2,W,2,0,"div",4)(3,tt,8,3,"div",5),t.k0s()),2&o&&(t.R7$(),t.Y8G("ngIf",n.tabs.length),t.R7$(),t.Y8G("ngIf",n.loading),t.R7$(),t.Y8G("ngIf",!n.loading&&n.selectedTab))},dependencies:[g.bT,p.sjL,h.nj_,k.xC],styles:[".modal[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background:#00000080;display:flex;justify-content:center;align-items:center}.modal-content[_ngcontent-%COMP%]{background:#fff;padding:20px;width:400px;border-radius:8px}.modal-actions[_ngcontent-%COMP%]{margin-top:15px;display:flex;justify-content:flex-end;gap:10px}.tab-card[_ngcontent-%COMP%]{border:1px solid #ddd;padding:10px;margin:5px 0;border-radius:5px}"]})}}return a})()}];let nt=(()=>{class a{static{this.\u0275fac=function(o){return new(o||a)}}static{this.\u0275mod=t.$C({type:a})}static{this.\u0275inj=t.G2t({imports:[y.iI.forChild(et),y.iI]})}}return a})();var ot=c(4046);let it=(()=>{class a{static{this.\u0275fac=function(o){return new(o||a)}}static{this.\u0275mod=t.$C({type:a})}static{this.\u0275inj=t.G2t({imports:[g.MD,l.YN,l.X1,nt,p.N8$,b.L,_.pc,ot.FP,f.p0,x._B,F,k.xC]})}}return a})()}}]);