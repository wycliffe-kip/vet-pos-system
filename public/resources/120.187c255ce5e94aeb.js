"use strict";(self.webpackChunkvet_pos_dev=self.webpackChunkvet_pos_dev||[]).push([[120],{1120:(rt,k,l)=>{l.r(k),l.d(k,{InventoryModule:()=>st});var v=l(177),d=l(9417),S=l(2183),m=l(3752),H=l(7468),t=l(4438),E=l(5993),C=l(5506),f=l(9556),y=l(4877),P=l(1063);const A=()=>({mode:"multiple"});function R(s,a){if(1&s){const e=t.RV6();t.j41(0,"dx-button",31),t.bIt("onClick",function(){const n=t.eBV(e).data,o=t.XpG();return t.Njj(o.openSingleAdjust(n))}),t.k0s(),t.j41(1,"dx-button",32),t.bIt("onClick",function(){const n=t.eBV(e).data,o=t.XpG();return t.Njj(o.openHistory(n))}),t.k0s()}}function V(s,a){if(1&s&&(t.j41(0,"p"),t.EFF(1,"Product: "),t.j41(2,"b"),t.EFF(3),t.k0s()()),2&s){const e=t.XpG();t.R7$(3),t.JRh(e.currentProduct.name)}}let T=(()=>{class s{constructor(e,i){this.inv=e,this.fb=i,this.products=[],this.popupVisible=!1,this.singlePopupVisible=!1,this.historyVisible=!1,this.selectedProducts=[],this.currentProduct=null,this.productHistory=[],this.bulkForm=this.fb.group({delta:[0]}),this.singleForm=this.fb.group({delta:[0]})}ngOnInit(){this.loadProducts()}loadProducts(){this.inv.list().subscribe({next:e=>this.products=e,error:()=>alert("Failed to load products.")})}onSelectionChanged(e){this.selectedProducts=e.selectedRowsData}openBulkAdjustment(){this.selectedProducts.length?(this.bulkForm.reset({delta:0}),this.popupVisible=!0):alert("Select at least one product.")}applyBulkAdjustment(){const e=this.bulkForm.value.delta;if(0===e)return alert("Enter a valid quantity.");const i=this.selectedProducts.map(n=>this.inv.adjustStock(n.id,e));(0,H.p)(i).subscribe({next:n=>{n.forEach(o=>{const r=this.products.find(u=>u.id===o.id);r&&(r.stock_quantity=o.stock_quantity)}),this.popupVisible=!1,this.selectedProducts=[],this.dataGrid.instance.clearSelection()},error:()=>alert("Failed to adjust some products.")})}openSingleAdjust(e){this.currentProduct=e,this.singleForm.reset({delta:0}),this.singlePopupVisible=!0}applySingleAdjustment(){const e=this.singleForm.value.delta;!this.currentProduct||0===e||this.inv.adjustStock(this.currentProduct.id,e).subscribe({next:i=>{const n=this.products.find(o=>o.id===i.id);n&&(n.stock_quantity=i.stock_quantity),this.singlePopupVisible=!1,this.currentProduct=null},error:()=>alert("Failed to adjust stock.")})}rowPrepared(e){"data"===e.rowType&&e.data.stock_quantity<=(e.data.lowStockThreshold||5)&&(e.rowElement.style.backgroundColor="#f8d7da")}openHistory(e){this.inv.getHistory(e.id).subscribe({next:i=>{this.productHistory=i,this.currentProduct=e,this.historyVisible=!0},error:()=>alert("Failed to load stock history.")})}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(E.c),t.rXU(d.ok))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-inventory-list"]],viewQuery:function(i,n){if(1&i&&t.GBs(m.sjL,5),2&i){let o;t.mGM(o=t.lsd())&&(n.dataGrid=o.first)}},decls:37,vars:34,consts:[["grid",""],["actionCell",""],[1,"inventory-layout","p-4"],[1,"flex","items-center","justify-between","mb-4"],[1,"text-lg","font-semibold"],["text","Bulk Adjust Stock","type","default",3,"onClick"],[3,"onSelectionChanged","onRowPrepared","dataSource","showBorders","columnAutoWidth","selection"],["dataField","name","caption","Product",3,"width"],["dataField","sku","caption","SKU",3,"width"],["dataField","stock_quantity","caption","Current Stock",3,"width"],["dataField","lowStockThreshold","caption","Low Stock Limit",3,"width"],["caption","Actions","cellTemplate","actionCell",3,"width"],["title","Bulk Stock Adjustment",3,"visibleChange","visible","width","height","showTitle"],[1,"p-4","space-y-4",3,"formGroup"],["formControlName","delta","placeholder","Enter quantity to adjust (+ or -)",3,"showSpinButtons"],[1,"flex","justify-end","gap-2","mt-6"],["text","Cancel","type","default",3,"onClick"],["text","Apply","type","success",3,"onClick"],["title","Adjust Stock",3,"visibleChange","visible","width","height","showTitle"],[1,"p-4","space-y-4"],[4,"ngIf"],[3,"formGroup"],[3,"visibleChange","visible","width","height","showTitle","title"],[1,"p-4"],[3,"dataSource","showBorders","columnAutoWidth"],["dataField","created_at","caption","Date",3,"width"],["dataField","delta","caption","Change",3,"width"],["dataField","previous_quantity","caption","Previous"],["dataField","new_quantity","caption","New"],["dataField","reason","caption","Reason"],["dataField","adjusted_by","caption","Adjusted By",3,"width"],["text","Adjust","icon","edit","stylingMode","text",3,"onClick"],["text","History","icon","clock","stylingMode","text",3,"onClick"]],template:function(i,n){if(1&i){const o=t.RV6();t.j41(0,"div",2)(1,"div",3)(2,"h3",4),t.EFF(3,"Inventory Management"),t.k0s(),t.j41(4,"dx-button",5),t.bIt("onClick",function(){return t.eBV(o),t.Njj(n.openBulkAdjustment())}),t.k0s()(),t.j41(5,"dx-data-grid",6,0),t.bIt("onSelectionChanged",function(u){return t.eBV(o),t.Njj(n.onSelectionChanged(u))})("onRowPrepared",function(u){return t.eBV(o),t.Njj(n.rowPrepared(u))}),t.nrm(7,"dxi-column",7)(8,"dxi-column",8)(9,"dxi-column",9)(10,"dxi-column",10)(11,"dxi-column",11),t.DNE(12,R,2,0,"ng-template",null,1,t.C5r),t.k0s(),t.j41(14,"dx-popup",12),t.mxI("visibleChange",function(u){return t.eBV(o),t.DH7(n.popupVisible,u)||(n.popupVisible=u),t.Njj(u)}),t.j41(15,"form",13),t.nrm(16,"dx-number-box",14),t.j41(17,"div",15)(18,"dx-button",16),t.bIt("onClick",function(){return t.eBV(o),t.Njj(n.popupVisible=!1)}),t.k0s(),t.j41(19,"dx-button",17),t.bIt("onClick",function(){return t.eBV(o),t.Njj(n.applyBulkAdjustment())}),t.k0s()()()(),t.j41(20,"dx-popup",18),t.mxI("visibleChange",function(u){return t.eBV(o),t.DH7(n.singlePopupVisible,u)||(n.singlePopupVisible=u),t.Njj(u)}),t.j41(21,"div",19),t.DNE(22,V,4,1,"p",20),t.j41(23,"form",21),t.nrm(24,"dx-number-box",14),t.k0s(),t.j41(25,"div",15)(26,"dx-button",16),t.bIt("onClick",function(){return t.eBV(o),t.Njj(n.singlePopupVisible=!1)}),t.k0s(),t.j41(27,"dx-button",17),t.bIt("onClick",function(){return t.eBV(o),t.Njj(n.applySingleAdjustment())}),t.k0s()()()(),t.j41(28,"dx-popup",22),t.mxI("visibleChange",function(u){return t.eBV(o),t.DH7(n.historyVisible,u)||(n.historyVisible=u),t.Njj(u)}),t.j41(29,"div",23)(30,"dx-data-grid",24),t.nrm(31,"dxi-column",25)(32,"dxi-column",26)(33,"dxi-column",27)(34,"dxi-column",28)(35,"dxi-column",29)(36,"dxi-column",30),t.k0s()()()()}2&i&&(t.R7$(5),t.Y8G("dataSource",n.products)("showBorders",!0)("columnAutoWidth",!0)("selection",t.lJ4(33,A)),t.R7$(2),t.Y8G("width",200),t.R7$(),t.Y8G("width",120),t.R7$(),t.Y8G("width",120),t.R7$(),t.Y8G("width",150),t.R7$(),t.Y8G("width",220),t.R7$(3),t.R50("visible",n.popupVisible),t.Y8G("width",400)("height",250)("showTitle",!0),t.R7$(),t.Y8G("formGroup",n.bulkForm),t.R7$(),t.Y8G("showSpinButtons",!0),t.R7$(4),t.R50("visible",n.singlePopupVisible),t.Y8G("width",400)("height",250)("showTitle",!0),t.R7$(2),t.Y8G("ngIf",n.currentProduct),t.R7$(),t.Y8G("formGroup",n.singleForm),t.R7$(),t.Y8G("showSpinButtons",!0),t.R7$(4),t.R50("visible",n.historyVisible),t.Y8G("width",600)("height",400)("showTitle",!0)("title","Stock History - "+((null==n.currentProduct?null:n.currentProduct.name)||"")),t.R7$(2),t.Y8G("dataSource",n.productHistory)("showBorders",!0)("columnAutoWidth",!0),t.R7$(),t.Y8G("width",160),t.R7$(),t.Y8G("width",100),t.R7$(4),t.Y8G("width",120))},dependencies:[v.bT,d.qT,d.BC,d.cb,d.j4,d.JD,m.sjL,P.nj_,C.e,f.iI,y.EZ]})}}return s})();var w=l(5794),G=l(8168),b=l(6676),B=l(1617),j=l(5767),p=l(1349),D=l(5632),$=l(7184),O=l(5042),g=l(2126),N=l(2463),I=l(4435),L=l(9055),M=l(8382);class F extends L.A{_getDefaultOptions(){return(0,G.A)({},super._getDefaultOptions(),{spellcheck:!0,autoResizeEnabled:!1,_shouldAttachKeyboardEvents:!1})}_shouldAttachKeyboardEvents(){const{_shouldAttachKeyboardEvents:a,readOnly:e}=this.option();return a||!e}_initMarkup(){this.$element().addClass("dx-textarea"),super._initMarkup(),this.setAria("multiline","true")}_renderContentImpl(){this._updateInputHeight(),super._renderContentImpl()}_renderInput(){super._renderInput(),this._renderScrollHandler()}_createInput(){const a=(0,$.A)("<textarea>");return this._applyInputAttributes(a,this.option("inputAttr")),this._updateInputAutoResizeAppearance(a),a}_setInputMinHeight(){}_renderScrollHandler(){this._eventY=0;const a=this._input(),e=(0,M.N)(a,!0);b.A.on(a,(0,p.b4)(B.A.init,this.NAME),e,O.lQ),b.A.on(a,(0,p.b4)(j.A.down,this.NAME),this._pointerDownHandler.bind(this)),b.A.on(a,(0,p.b4)(j.A.move,this.NAME),this._pointerMoveHandler.bind(this))}_pointerDownHandler(a){this._eventY=(0,p.rw)(a).y}_pointerMoveHandler(a){const e=(0,p.rw)(a).y,i=this._eventY-e;(0,M.f)(this._input(),i)&&(a.isScrollingEvent=!0,a.stopPropagation()),this._eventY=e}_renderDimensions(){const a=this.$element(),e=a.get(0),i=this._getOptionValue("width",e),n=this._getOptionValue("height",e),o=this.option("minHeight"),r=this.option("maxHeight");a.css({minHeight:void 0!==o?o:"",maxHeight:void 0!==r?r:"",width:i,height:n})}_resetDimensions(){this.$element().css({height:"",minHeight:"",maxHeight:""})}_renderEvents(){this.option("autoResizeEnabled")&&b.A.on(this._input(),(0,p.b4)("input paste",this.NAME),this._updateInputHeight.bind(this)),super._renderEvents()}_refreshEvents(){b.A.off(this._input(),(0,p.b4)("input paste",this.NAME)),super._refreshEvents()}_getHeightDifference(a){return(0,g.pD)(this.$element().get(0),!1)+(0,g.pD)(this._$textEditorContainer.get(0),!1)+(0,g.pD)(this._$textEditorInputContainer.get(0),!0)+(0,g.GU)("height",(0,I.zk)().getComputedStyle(a.get(0))).margin}_updateInputHeight(){if(!(0,I.Vd)())return;const a=this._input(),e=this.option("height"),i=void 0===e&&this.option("autoResizeEnabled");if(!(i||void 0===e&&this.option("minHeight")))return void a.css("height","");this._resetDimensions(),this.$element().css("height",(0,g.P$)(this.$element())),a.css("height",0);const o=this._getHeightDifference(a);this._renderDimensions();const r=this._getBoundaryHeight("minHeight"),u=this._getBoundaryHeight("maxHeight");let c=a[0].scrollHeight;if(void 0!==r&&(c=Math.max(c,r-o)),void 0!==u){const _=u-o,at=c>_;c=Math.min(c,_),this._updateInputAutoResizeAppearance(a,!at)}a.css("height",c),i&&this.$element().css("height","auto")}_getBoundaryHeight(a){const e=this.option(a);if((0,N.O9)(e))return"number"==typeof e?e:(0,g.hP)(e,this.$element().get(0).parentElement,this.$element().get(0))}_renderInputType(){}_visibilityChanged(a){a&&this._updateInputHeight()}_updateInputAutoResizeAppearance(a,e){if(a){const i=(0,O.YD)(e,this.option("autoResizeEnabled"));a.toggleClass("dx-texteditor-input-auto-resize",i)}}_dimensionChanged(){this.option("visible")&&this._updateInputHeight()}_optionChanged(a){const{name:e,value:i}=a;switch(e){case"_shouldAttachKeyboardEvents":case"autoResizeEnabled":this._updateInputAutoResizeAppearance(this._input(),i),this._refreshEvents(),this._updateInputHeight();break;case"value":case"height":super._optionChanged(a),this._updateInputHeight();break;case"minHeight":case"maxHeight":this._renderDimensions(),this._updateInputHeight();break;case"visible":super._optionChanged(a),i&&this._updateInputHeight();break;default:super._optionChanged(a)}}}(0,D.A)("dxTextArea",F);const Y=F;var h=l(5245);const z={provide:d.kq,useExisting:(0,t.Rfq)(()=>x),multi:!0};let x=(()=>{class s extends h.ic{_watcherHelper;_idh;instance=null;get accessKey(){return this._getOption("accessKey")}set accessKey(e){this._setOption("accessKey",e)}get activeStateEnabled(){return this._getOption("activeStateEnabled")}set activeStateEnabled(e){this._setOption("activeStateEnabled",e)}get autoResizeEnabled(){return this._getOption("autoResizeEnabled")}set autoResizeEnabled(e){this._setOption("autoResizeEnabled",e)}get disabled(){return this._getOption("disabled")}set disabled(e){this._setOption("disabled",e)}get elementAttr(){return this._getOption("elementAttr")}set elementAttr(e){this._setOption("elementAttr",e)}get focusStateEnabled(){return this._getOption("focusStateEnabled")}set focusStateEnabled(e){this._setOption("focusStateEnabled",e)}get height(){return this._getOption("height")}set height(e){this._setOption("height",e)}get hint(){return this._getOption("hint")}set hint(e){this._setOption("hint",e)}get hoverStateEnabled(){return this._getOption("hoverStateEnabled")}set hoverStateEnabled(e){this._setOption("hoverStateEnabled",e)}get inputAttr(){return this._getOption("inputAttr")}set inputAttr(e){this._setOption("inputAttr",e)}get isDirty(){return this._getOption("isDirty")}set isDirty(e){this._setOption("isDirty",e)}get isValid(){return this._getOption("isValid")}set isValid(e){this._setOption("isValid",e)}get label(){return this._getOption("label")}set label(e){this._setOption("label",e)}get labelMode(){return this._getOption("labelMode")}set labelMode(e){this._setOption("labelMode",e)}get maxHeight(){return this._getOption("maxHeight")}set maxHeight(e){this._setOption("maxHeight",e)}get maxLength(){return this._getOption("maxLength")}set maxLength(e){this._setOption("maxLength",e)}get minHeight(){return this._getOption("minHeight")}set minHeight(e){this._setOption("minHeight",e)}get name(){return this._getOption("name")}set name(e){this._setOption("name",e)}get placeholder(){return this._getOption("placeholder")}set placeholder(e){this._setOption("placeholder",e)}get readOnly(){return this._getOption("readOnly")}set readOnly(e){this._setOption("readOnly",e)}get rtlEnabled(){return this._getOption("rtlEnabled")}set rtlEnabled(e){this._setOption("rtlEnabled",e)}get spellcheck(){return this._getOption("spellcheck")}set spellcheck(e){this._setOption("spellcheck",e)}get stylingMode(){return this._getOption("stylingMode")}set stylingMode(e){this._setOption("stylingMode",e)}get tabIndex(){return this._getOption("tabIndex")}set tabIndex(e){this._setOption("tabIndex",e)}get text(){return this._getOption("text")}set text(e){this._setOption("text",e)}get validationError(){return this._getOption("validationError")}set validationError(e){this._setOption("validationError",e)}get validationErrors(){return this._getOption("validationErrors")}set validationErrors(e){this._setOption("validationErrors",e)}get validationMessageMode(){return this._getOption("validationMessageMode")}set validationMessageMode(e){this._setOption("validationMessageMode",e)}get validationMessagePosition(){return this._getOption("validationMessagePosition")}set validationMessagePosition(e){this._setOption("validationMessagePosition",e)}get validationStatus(){return this._getOption("validationStatus")}set validationStatus(e){this._setOption("validationStatus",e)}get value(){return this._getOption("value")}set value(e){this._setOption("value",e)}get valueChangeEvent(){return this._getOption("valueChangeEvent")}set valueChangeEvent(e){this._setOption("valueChangeEvent",e)}get visible(){return this._getOption("visible")}set visible(e){this._setOption("visible",e)}get width(){return this._getOption("width")}set width(e){this._setOption("width",e)}onChange;onContentReady;onCopy;onCut;onDisposing;onEnterKey;onFocusIn;onFocusOut;onInitialized;onInput;onKeyDown;onKeyUp;onOptionChanged;onPaste;onValueChanged;accessKeyChange;activeStateEnabledChange;autoResizeEnabledChange;disabledChange;elementAttrChange;focusStateEnabledChange;heightChange;hintChange;hoverStateEnabledChange;inputAttrChange;isDirtyChange;isValidChange;labelChange;labelModeChange;maxHeightChange;maxLengthChange;minHeightChange;nameChange;placeholderChange;readOnlyChange;rtlEnabledChange;spellcheckChange;stylingModeChange;tabIndexChange;textChange;validationErrorChange;validationErrorsChange;validationMessageModeChange;validationMessagePositionChange;validationStatusChange;valueChange;valueChangeEventChange;visibleChange;widthChange;onBlur;change(e){}touched=e=>{};constructor(e,i,n,o,r,u,c,_){super(e,i,n,o,c,_),this._watcherHelper=o,this._idh=r,this._createEventEmitters([{subscribe:"change",emit:"onChange"},{subscribe:"contentReady",emit:"onContentReady"},{subscribe:"copy",emit:"onCopy"},{subscribe:"cut",emit:"onCut"},{subscribe:"disposing",emit:"onDisposing"},{subscribe:"enterKey",emit:"onEnterKey"},{subscribe:"focusIn",emit:"onFocusIn"},{subscribe:"focusOut",emit:"onFocusOut"},{subscribe:"initialized",emit:"onInitialized"},{subscribe:"input",emit:"onInput"},{subscribe:"keyDown",emit:"onKeyDown"},{subscribe:"keyUp",emit:"onKeyUp"},{subscribe:"optionChanged",emit:"onOptionChanged"},{subscribe:"paste",emit:"onPaste"},{subscribe:"valueChanged",emit:"onValueChanged"},{emit:"accessKeyChange"},{emit:"activeStateEnabledChange"},{emit:"autoResizeEnabledChange"},{emit:"disabledChange"},{emit:"elementAttrChange"},{emit:"focusStateEnabledChange"},{emit:"heightChange"},{emit:"hintChange"},{emit:"hoverStateEnabledChange"},{emit:"inputAttrChange"},{emit:"isDirtyChange"},{emit:"isValidChange"},{emit:"labelChange"},{emit:"labelModeChange"},{emit:"maxHeightChange"},{emit:"maxLengthChange"},{emit:"minHeightChange"},{emit:"nameChange"},{emit:"placeholderChange"},{emit:"readOnlyChange"},{emit:"rtlEnabledChange"},{emit:"spellcheckChange"},{emit:"stylingModeChange"},{emit:"tabIndexChange"},{emit:"textChange"},{emit:"validationErrorChange"},{emit:"validationErrorsChange"},{emit:"validationMessageModeChange"},{emit:"validationMessagePositionChange"},{emit:"validationStatusChange"},{emit:"valueChange"},{emit:"valueChangeEventChange"},{emit:"visibleChange"},{emit:"widthChange"},{emit:"onBlur"}]),this._idh.setHost(this),u.setHost(this)}_createInstance(e,i){return new Y(e,i)}writeValue(e){this.eventHelper.lockedValueChangeEvent=!0,this.value=e,this.eventHelper.lockedValueChangeEvent=!1}setDisabledState(e){this.disabled=e}registerOnChange(e){this.change=e}registerOnTouched(e){this.touched=e}_createWidget(e){super._createWidget(e),this.instance.on("focusOut",i=>{this.eventHelper.fireNgEvent("onBlur",[i])})}ngOnDestroy(){this._destroyWidget()}ngOnChanges(e){super.ngOnChanges(e),this.setupChanges("validationErrors",e)}setupChanges(e,i){e in this._optionsToUpdate||this._idh.setup(e,i)}ngDoCheck(){this._idh.doCheck("validationErrors"),this._watcherHelper.checkWatchers(),super.ngDoCheck(),super.clearChangedOptions()}_setOption(e,i){let n=this._idh.setupSingle(e,i),o=null!==this._idh.getChanges(e,i);(n||o)&&super._setOption(e,i)}static \u0275fac=function(i){return new(i||s)(t.rXU(t.aKT),t.rXU(t.SKi),t.rXU(h.zF),t.rXU(h.jS),t.rXU(h.$M),t.rXU(h.fH),t.rXU(t.pJN),t.rXU(t.Agw))};static \u0275cmp=t.VBU({type:s,selectors:[["dx-text-area"]],hostAttrs:["ngSkipHydration","true"],hostBindings:function(i,n){1&i&&t.bIt("valueChange",function(r){return n.change(r)})("onBlur",function(r){return n.touched(r)})},inputs:{accessKey:"accessKey",activeStateEnabled:"activeStateEnabled",autoResizeEnabled:"autoResizeEnabled",disabled:"disabled",elementAttr:"elementAttr",focusStateEnabled:"focusStateEnabled",height:"height",hint:"hint",hoverStateEnabled:"hoverStateEnabled",inputAttr:"inputAttr",isDirty:"isDirty",isValid:"isValid",label:"label",labelMode:"labelMode",maxHeight:"maxHeight",maxLength:"maxLength",minHeight:"minHeight",name:"name",placeholder:"placeholder",readOnly:"readOnly",rtlEnabled:"rtlEnabled",spellcheck:"spellcheck",stylingMode:"stylingMode",tabIndex:"tabIndex",text:"text",validationError:"validationError",validationErrors:"validationErrors",validationMessageMode:"validationMessageMode",validationMessagePosition:"validationMessagePosition",validationStatus:"validationStatus",value:"value",valueChangeEvent:"valueChangeEvent",visible:"visible",width:"width"},outputs:{onChange:"onChange",onContentReady:"onContentReady",onCopy:"onCopy",onCut:"onCut",onDisposing:"onDisposing",onEnterKey:"onEnterKey",onFocusIn:"onFocusIn",onFocusOut:"onFocusOut",onInitialized:"onInitialized",onInput:"onInput",onKeyDown:"onKeyDown",onKeyUp:"onKeyUp",onOptionChanged:"onOptionChanged",onPaste:"onPaste",onValueChanged:"onValueChanged",accessKeyChange:"accessKeyChange",activeStateEnabledChange:"activeStateEnabledChange",autoResizeEnabledChange:"autoResizeEnabledChange",disabledChange:"disabledChange",elementAttrChange:"elementAttrChange",focusStateEnabledChange:"focusStateEnabledChange",heightChange:"heightChange",hintChange:"hintChange",hoverStateEnabledChange:"hoverStateEnabledChange",inputAttrChange:"inputAttrChange",isDirtyChange:"isDirtyChange",isValidChange:"isValidChange",labelChange:"labelChange",labelModeChange:"labelModeChange",maxHeightChange:"maxHeightChange",maxLengthChange:"maxLengthChange",minHeightChange:"minHeightChange",nameChange:"nameChange",placeholderChange:"placeholderChange",readOnlyChange:"readOnlyChange",rtlEnabledChange:"rtlEnabledChange",spellcheckChange:"spellcheckChange",stylingModeChange:"stylingModeChange",tabIndexChange:"tabIndexChange",textChange:"textChange",validationErrorChange:"validationErrorChange",validationErrorsChange:"validationErrorsChange",validationMessageModeChange:"validationMessageModeChange",validationMessagePositionChange:"validationMessagePositionChange",validationStatusChange:"validationStatusChange",valueChange:"valueChange",valueChangeEventChange:"valueChangeEventChange",visibleChange:"visibleChange",widthChange:"widthChange",onBlur:"onBlur"},standalone:!0,features:[t.Jv_([h.zF,h.jS,z,h.fH,h.$M]),t.Vt3,t.OA$,t.aNF],decls:0,vars:0,template:function(i,n){},dependencies:[h.p_],encapsulation:2})}return s})(),U=(()=>{class s{static \u0275fac=function(i){return new(i||s)};static \u0275mod=t.$C({type:s});static \u0275inj=t.G2t({imports:[x,h.p_,h.xZ,h.xZ]})}return s})();const K=()=>({pageSize:10}),W=()=>({visible:!0,width:"100%",placeholder:"Search..."}),X=()=>({mode:"standard",showScrollbar:"onScroll"});function J(s,a){if(1&s){const e=t.RV6();t.j41(0,"div")(1,"div",42)(2,"dx-button",43),t.bIt("onClick",function(){const n=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.editProduct(n.data))}),t.k0s(),t.j41(3,"dx-button",44),t.bIt("onClick",function(){const n=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.addStock(n.data))}),t.k0s(),t.j41(4,"dx-button",45),t.bIt("onClick",function(){const n=t.eBV(e).$implicit,o=t.XpG();return t.Njj(o.viewStockHistory(n.data))}),t.k0s()()()}}function Q(s,a){1&s&&(t.j41(0,"div",46)(1,"p"),t.EFF(2,"Loading products..."),t.k0s()())}function q(s,a){if(1&s&&(t.j41(0,"option",24),t.EFF(1),t.k0s()),2&s){const e=a.$implicit;t.Y8G("value",e.id),t.R7$(),t.JRh(e.name)}}function Z(s,a){if(1&s&&(t.j41(0,"option",24),t.EFF(1),t.k0s()),2&s){const e=a.$implicit;t.Y8G("value",e.id),t.R7$(),t.JRh(e.name)}}function tt(s,a){if(1&s&&(t.j41(0,"div")(1,"dx-data-grid",47),t.nrm(2,"dxi-column",48)(3,"dxi-column",49)(4,"dxi-column",50)(5,"dxi-column",51)(6,"dxi-column",52),t.k0s()()),2&s){const e=t.XpG();t.R7$(),t.Y8G("dataSource",e.selectedProductHistory)("showBorders",!0)("columnAutoWidth",!0)}}function et(s,a){if(1&s&&(t.j41(0,"div",53),t.EFF(1),t.k0s()),2&s){const e=t.XpG();t.R7$(),t.SpI(" No stock adjustment history for ",e.selectedProductName," ")}}const nt=[{path:"",component:(()=>{class s{constructor(e,i,n){this.inventoryService=e,this.toastr=i,this.fb=n,this.products=[],this.isEditing=!1,this.selectedProductId=null,this.loading=!1,this.showHistoryPopup=!1,this.selectedProductHistory=[],this.selectedProduct=null,this.selectedProductName="",this.showAdjustStockPopup=!1,this.showAddStockPopup=!1,this.isLowStockView=!1,this.screenWidth=window.innerWidth,this.screenHeight=window.innerHeight,this.showProductFormPopup=!1}ngOnInit(){this.screenWidth=window.innerWidth,this.screenHeight=window.innerHeight,window.addEventListener("resize",()=>{this.screenWidth=window.innerWidth,this.screenHeight=window.innerHeight}),this.form=this.fb.group({name:["",d.k0.required],sku:[""],category_id:[null],description:[""],unit_id:[null],unit_price:[0,d.k0.required],stock_quantity:[0,d.k0.required],low_stock_threshold:[10],is_enabled:[!0]}),this.addStockForm=this.fb.group({stock_quantity:[1,[d.k0.required,d.k0.min(1)]],reason:["Stock replenishment"]}),this.loadProducts(),this.loadCategories(),this.loadUnits()}openProductFormPopup(e){e?(this.isEditing=!0,this.selectedProductId=e.id,this.form.patchValue(e)):this.resetForm(),this.showProductFormPopup=!0}closeProductFormPopup(){this.showProductFormPopup=!1,this.resetForm()}editProduct(e){this.openProductFormPopup(e),this.form.patchValue(e)}loadProducts(){this.loading=!0,this.inventoryService.list().subscribe({next:e=>{this.products=e,this.loading=!1},error:()=>{this.toastr.error("Failed to load products"),this.loading=!1}})}loadCategories(){this.inventoryService.getCategories().subscribe({next:e=>this.categories=e,error:()=>this.toastr.error("Failed to load categories")})}loadUnits(){this.inventoryService.getUnits().subscribe({next:e=>this.units=e,error:()=>this.toastr.error("Failed to load units")})}onSubmit(){if(this.form.invalid)return;const e=this.form.value;this.loading=!0,this.isEditing&&this.selectedProductId?this.inventoryService.update(this.selectedProductId,e).subscribe({next:()=>{this.toastr.success("Product updated successfully"),this.resetForm(),this.loadProducts()},error:()=>{this.toastr.error("Failed to update product"),this.loading=!1}}):this.inventoryService.create(e).subscribe({next:()=>{this.toastr.success("Product created successfully"),this.resetForm(),this.loadProducts()},error:()=>{this.toastr.error("Failed to create product"),this.loading=!1}})}resetForm(){this.form.reset({stock_quantity:0,lowStockThreshold:5}),this.isEditing=!1,this.selectedProductId=null}adjustStock(e,i){if(!i)return;const n=e.stock_quantity;e.stock_quantity+=i,this.inventoryService.adjustStock(e.id,i).subscribe({next:o=>{e.stock_quantity=o.stock_quantity,this.toastr.success(`Stock adjusted for ${e.name}`)},error:()=>{e.stock_quantity=n,this.toastr.error("Stock adjustment failed")}})}submitAdjustStock(){if(!this.selectedProduct)return;const{delta:e,reason:i}=this.adjustStockForm.value;this.inventoryService.adjustStock(this.selectedProduct.id,e,i).subscribe({next:n=>{this.selectedProduct.stock_quantity=n.stock_quantity,this.loadProducts(),this.toastr.success("Stock adjusted successfully"),this.closeAdjustStockPopup()},error:()=>{this.toastr.error("Stock adjustment failed")}})}closeAdjustStockPopup(){this.showAdjustStockPopup=!1,this.selectedProduct=null}addStock(e){this.selectedProduct=e,this.addStockForm.reset({stock_quantity:1,reason:"New Stock Received"}),this.showAddStockPopup=!0}closeAddStockPopup(){this.showAddStockPopup=!1,this.selectedProduct=null}confirmAddStock(){if(!this.selectedProduct||this.addStockForm.invalid)return;const{stock_quantity:e,reason:i}=this.addStockForm.value;this.inventoryService.adjustStock(this.selectedProduct.id,e,i).subscribe({next:n=>{console.log("Response from backend:",n),this.selectedProduct.stock_quantity=n.stock_quantity,this.toastr.success(`Added ${e} to ${this.selectedProduct.name}`),this.closeAddStockPopup(),this.loadProducts()},error:n=>{console.error(n),this.toastr.error("Failed to add stock")}})}toggleLowStock(){this.loading=!0,this.isLowStockView?this.inventoryService.list().subscribe({next:e=>{this.products=e,this.loading=!1,this.isLowStockView=!1,this.dataGrid&&(this.dataGrid.instance.clearFilter(),this.dataGrid.instance.clearSorting(),this.dataGrid.instance.searchByText(""))},error:()=>{this.toastr.error("Failed to load products"),this.loading=!1}}):this.inventoryService.lowStockProducts().subscribe({next:e=>{this.products=e,this.loading=!1,this.isLowStockView=!0,this.dataGrid&&(this.dataGrid.instance.clearFilter(),this.dataGrid.instance.clearSorting(),this.dataGrid.instance.searchByText(""))},error:()=>{this.toastr.error("Failed to fetch low stock products"),this.loading=!1}})}resetGridFilters(){this.dataGrid&&(this.dataGrid.instance.clearFilter(),this.dataGrid.instance.clearSorting(),this.dataGrid.instance.searchByText(""))}viewStockHistory(e){this.selectedProductName=e.name,this.selectedProductHistory=[],this.showHistoryPopup=!0,this.inventoryService.getStockHistory(e.id).subscribe({next:i=>this.selectedProductHistory=i,error:()=>this.toastr.error("Failed to load stock history")})}closeHistoryPopup(){this.showHistoryPopup=!1}static{this.\u0275fac=function(i){return new(i||s)(t.rXU(E.c),t.rXU(w.tw),t.rXU(d.ok))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-inventory-management"]],viewQuery:function(i,n){if(1&i&&t.GBs(m.sjL,5),2&i){let o;t.mGM(o=t.lsd())&&(n.dataGrid=o.first)}},decls:93,vars:50,consts:[["noHistory",""],[1,"inventory-container"],[1,"page-title"],[1,"toolbar"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-warning",3,"click"],[1,"table-card","table-responsive"],[3,"dataSource","showBorders","columnAutoWidth","hoverStateEnabled","rowAlternationEnabled","allowColumnResizing","columnHidingEnabled","columnMinWidth","paging","searchPanel","scrolling","wordWrapEnabled","showColumnLines","showRowLines"],["dataField","name","caption","Product Name"],["dataField","sku","caption","SKU"],["dataField","category_name","caption","Category"],["dataField","unit_name","caption","Unit of Measure"],["dataField","unit_price","caption","Unit Price","dataType","number","format","#,##0.00"],["dataField","stock_quantity","caption","Stock Quantity"],["caption","Actions","cellTemplate","actionButtons"],[4,"dxTemplate","dxTemplateOf"],["class","loading-text",4,"ngIf"],["closeOnOutsideClick","true",3,"onHiding","visible","dragEnabled","width","height","title"],[1,"popup-content"],[1,"product-form",3,"ngSubmit","formGroup"],[1,"form-group"],["type","text","formControlName","name","placeholder","Enter name",1,"form-control"],["type","text","formControlName","sku","placeholder","Enter SKU",1,"form-control"],["formControlName","category_id",1,"form-select"],[3,"value"],[3,"value",4,"ngFor","ngForOf"],["formControlName","unit_id",1,"form-select"],["type","number","formControlName","unit_price","placeholder","Enter unit price",1,"form-control"],["type","number","formControlName","stock_quantity","min","0",1,"form-control"],["type","number","formControlName","low_stock_threshold","min","0",1,"form-control"],["formControlName","is_enabled",1,"form-select"],["formControlName","description","placeholder","Enter description",1,"form-control"],[1,"form-actions"],["text","Cancel","type","normal",3,"onClick"],["type","success",3,"text","useSubmitBehavior"],["closeOnOutsideClick","true","title","Add Stock",3,"onHiding","visible","dragEnabled","width","height"],["formControlName","stock_quantity",3,"min","showSpinButtons"],[3,"onValueChanged","value"],["text","Add","type","success",3,"useSubmitBehavior"],["closeOnOutsideClick","true","title","Stock Adjustment History",3,"onHiding","visible","width","height","dragEnabled"],[1,"popup-close-btn","btn-remove",3,"click"],[4,"ngIf","ngIfElse"],[1,"d-flex","flex-wrap","action-buttons"],["text","Edit","icon","edit","type","normal","stylingMode","outlined",1,"btn-secondary",3,"onClick"],["text","Add Stock","icon","add","type","default","stylingMode","outlined",1,"btn-primary",3,"onClick"],["text","History","icon","clock","type","normal","stylingMode","outlined",1,"btn-view",3,"onClick"],[1,"loading-text"],[3,"dataSource","showBorders","columnAutoWidth"],["dataField","created_at","caption","Date"],["dataField","change","caption","Change"],["dataField","new_quantity","caption","New Quantity"],["dataField","reason","caption","Reason"],["dataField","adjusted_by","caption","Adjusted By"],[1,"no-history"]],template:function(i,n){if(1&i){const o=t.RV6();t.j41(0,"div",1)(1,"h2",2),t.EFF(2,"Inventory Management"),t.k0s(),t.j41(3,"div",3)(4,"button",4),t.bIt("click",function(){return t.eBV(o),t.Njj(n.openProductFormPopup())}),t.EFF(5,"Add Product"),t.k0s(),t.j41(6,"button",5),t.bIt("click",function(){return t.eBV(o),t.Njj(n.toggleLowStock())}),t.EFF(7),t.k0s()(),t.j41(8,"div",6)(9,"dx-data-grid",7),t.nrm(10,"dxi-column",8)(11,"dxi-column",9)(12,"dxi-column",10)(13,"dxi-column",11)(14,"dxi-column",12)(15,"dxi-column",13)(16,"dxi-column",14),t.DNE(17,J,5,0,"div",15),t.k0s()(),t.DNE(18,Q,3,0,"div",16),t.k0s(),t.j41(19,"dx-popup",17),t.bIt("onHiding",function(){return t.eBV(o),t.Njj(n.closeProductFormPopup())}),t.j41(20,"div",18)(21,"form",19),t.bIt("ngSubmit",function(){return t.eBV(o),t.Njj(n.onSubmit())}),t.j41(22,"div",20)(23,"label"),t.EFF(24,"Product Name"),t.k0s(),t.nrm(25,"input",21),t.k0s(),t.j41(26,"div",20)(27,"label"),t.EFF(28,"SKU"),t.k0s(),t.nrm(29,"input",22),t.k0s(),t.j41(30,"div",20)(31,"label"),t.EFF(32,"Category"),t.k0s(),t.j41(33,"select",23)(34,"option",24),t.EFF(35,"Select Category"),t.k0s(),t.DNE(36,q,2,2,"option",25),t.k0s()(),t.j41(37,"div",20)(38,"label"),t.EFF(39,"Unit of Measure"),t.k0s(),t.j41(40,"select",26)(41,"option",24),t.EFF(42,"Select Unit"),t.k0s(),t.DNE(43,Z,2,2,"option",25),t.k0s()(),t.j41(44,"div",20)(45,"label"),t.EFF(46,"Unit Price"),t.k0s(),t.nrm(47,"input",27),t.k0s(),t.j41(48,"div",20)(49,"label"),t.EFF(50,"Stock Quantity"),t.k0s(),t.nrm(51,"input",28),t.k0s(),t.j41(52,"div",20)(53,"label"),t.EFF(54,"Low Stock Threshold"),t.k0s(),t.nrm(55,"input",29),t.k0s(),t.j41(56,"div",20)(57,"label"),t.EFF(58,"Status"),t.k0s(),t.j41(59,"select",30)(60,"option",24),t.EFF(61,"Enabled"),t.k0s(),t.j41(62,"option",24),t.EFF(63,"Disabled"),t.k0s()()(),t.j41(64,"div",20)(65,"label"),t.EFF(66,"Description"),t.k0s(),t.nrm(67,"textarea",31),t.k0s(),t.j41(68,"div",32)(69,"dx-button",33),t.bIt("onClick",function(){return t.eBV(o),t.Njj(n.closeProductFormPopup())}),t.k0s(),t.nrm(70,"dx-button",34),t.k0s()()()(),t.j41(71,"dx-popup",35),t.bIt("onHiding",function(){return t.eBV(o),t.Njj(n.closeAddStockPopup())}),t.j41(72,"div",18)(73,"form",19),t.bIt("ngSubmit",function(){return t.eBV(o),t.Njj(n.confirmAddStock())}),t.j41(74,"div",20)(75,"label"),t.EFF(76),t.k0s()(),t.j41(77,"div",20)(78,"label"),t.EFF(79,"Quantity"),t.k0s(),t.nrm(80,"dx-number-box",36),t.k0s(),t.j41(81,"div",20)(82,"dx-text-area",37),t.bIt("onValueChanged",function(u){let c;return t.eBV(o),t.Njj(null==(c=n.addStockForm.get("reason"))?null:c.setValue(u.value))}),t.k0s()(),t.j41(83,"div",32)(84,"dx-button",33),t.bIt("onClick",function(){return t.eBV(o),t.Njj(n.closeAddStockPopup())}),t.k0s(),t.nrm(85,"dx-button",38),t.k0s()()()(),t.j41(86,"dx-popup",39),t.bIt("onHiding",function(){return t.eBV(o),t.Njj(n.closeHistoryPopup())}),t.j41(87,"div",18)(88,"button",40),t.bIt("click",function(){return t.eBV(o),t.Njj(n.closeHistoryPopup())}),t.EFF(89,"close"),t.k0s(),t.DNE(90,tt,7,3,"div",41)(91,et,2,1,"ng-template",null,0,t.C5r),t.k0s()()}if(2&i){let o;const r=t.sdS(92);t.R7$(7),t.SpI(" ",n.isLowStockView?"Show All Products":"Show Low Stock"," "),t.R7$(2),t.Y8G("dataSource",n.products)("showBorders",!0)("columnAutoWidth",!0)("hoverStateEnabled",!0)("rowAlternationEnabled",!0)("allowColumnResizing",!0)("columnHidingEnabled",!0)("columnMinWidth",120)("paging",t.lJ4(47,K))("searchPanel",t.lJ4(48,W))("scrolling",t.lJ4(49,X))("wordWrapEnabled",!0)("showColumnLines",!0)("showRowLines",!0),t.R7$(8),t.Y8G("dxTemplateOf","actionButtons"),t.R7$(),t.Y8G("ngIf",n.loading),t.R7$(),t.FS9("title",n.isEditing?"Edit Product":"Add Product"),t.Y8G("visible",n.showProductFormPopup)("dragEnabled",!0)("width",n.screenWidth<768?"90%":600)("height",n.screenHeight<600?"90%":600),t.R7$(2),t.Y8G("formGroup",n.form),t.R7$(13),t.Y8G("value",null),t.R7$(2),t.Y8G("ngForOf",n.categories),t.R7$(5),t.Y8G("value",null),t.R7$(2),t.Y8G("ngForOf",n.units),t.R7$(17),t.Y8G("value",!0),t.R7$(2),t.Y8G("value",!1),t.R7$(8),t.FS9("text",n.isEditing?"Update":"Add"),t.Y8G("useSubmitBehavior",!0),t.R7$(),t.Y8G("visible",n.showAddStockPopup)("dragEnabled",!0)("width",n.screenWidth<768?"90%":400)("height",n.screenHeight<600?"90%":400),t.R7$(2),t.Y8G("formGroup",n.addStockForm),t.R7$(3),t.SpI("Product: ",null==n.selectedProduct?null:n.selectedProduct.name,""),t.R7$(4),t.Y8G("min",1)("showSpinButtons",!0),t.R7$(2),t.Y8G("value",null==(o=n.addStockForm.get("reason"))?null:o.value),t.R7$(3),t.Y8G("useSubmitBehavior",!0),t.R7$(),t.Y8G("visible",n.showHistoryPopup)("width",n.screenWidth<768?"90%":700)("height",n.screenHeight<600?"90%":500)("dragEnabled",!0),t.R7$(4),t.Y8G("ngIf",n.selectedProductHistory.length)("ngIfElse",r)}},dependencies:[v.Sq,v.bT,d.qT,d.xH,d.y7,d.me,d.Q0,d.wz,d.BC,d.cb,d.VZ,d.j4,d.JD,m.sjL,P.nj_,h.eC,C.e,f.iI,y.EZ,x],styles:[".inventory-container[_ngcontent-%COMP%]{min-height:100vh;background:#f5f7fa;font-family:Segoe UI,Roboto,Arial,sans-serif;color:#333;padding:20px}.page-title[_ngcontent-%COMP%]{font-size:28px;font-weight:700;color:#222;text-align:center;margin-bottom:20px}.popup-close-btn[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;border:none;background:transparent;font-size:22px;cursor:pointer;color:#333;font-weight:700;transition:color .2s ease}.popup-close-btn[_ngcontent-%COMP%]:hover{color:#ff4d4f}.center[_ngcontent-%COMP%]{text-align:center;margin-bottom:15px}.toolbar[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;margin-bottom:10px;gap:10px}.toolbar[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{font-size:20px;font-weight:600;margin:0}.btn[_ngcontent-%COMP%]{border:none;border-radius:8px;padding:10px 18px;cursor:pointer;font-weight:600;transition:all .2s ease}.btn[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}.btn-primary[_ngcontent-%COMP%]{background-color:#4f46e5;color:#fff}.btn-primary[_ngcontent-%COMP%]:hover{background-color:#4338ca}.btn-warning[_ngcontent-%COMP%]{background-color:#f59e0b;color:#fff}.btn-warning[_ngcontent-%COMP%]:hover{background-color:#d97706}.table-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 3px 12px #0000000f;padding:20px;transition:box-shadow .3s;overflow-x:auto}.table-card[_ngcontent-%COMP%]:hover{box-shadow:0 6px 20px #00000014}.action-buttons[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:6px}.product-form[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:15px;background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 16px #0000000d}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;font-size:14px;margin-bottom:5px}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%], .form-group[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{border:1px solid #ccc;border-radius:8px;padding:8px 12px;font-size:14px}.form-actions[_ngcontent-%COMP%]{grid-column:1 / -1;display:flex;justify-content:flex-end;gap:10px}.loading-text[_ngcontent-%COMP%]{text-align:center;margin-top:20px;font-size:14px;color:#777}.no-history[_ngcontent-%COMP%]{text-align:center;margin-top:20px;font-size:14px;color:#888}.popup-content[_ngcontent-%COMP%]{padding:15px;max-height:90vh;overflow-y:auto}@media (max-width: 768px){.toolbar[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:10px}.table-card[_ngcontent-%COMP%]{padding:15px}.product-form[_ngcontent-%COMP%]{grid-template-columns:1fr;padding:15px}}"]})}}return s})(),children:[{path:"",redirectTo:"list",pathMatch:"full"},{path:"list",component:T}]}];let it=(()=>{class s{static{this.\u0275fac=function(i){return new(i||s)}}static{this.\u0275mod=t.$C({type:s})}static{this.\u0275inj=t.G2t({imports:[S.iI.forChild(nt),S.iI]})}}return s})();var ot=l(4046);let st=(()=>{class s{static{this.\u0275fac=function(i){return new(i||s)}}static{this.\u0275mod=t.$C({type:s})}static{this.\u0275inj=t.G2t({imports:[v.MD,d.YN,d.X1,it,m.N8$,C.L,f.pc,ot.FP,y.p0,w._B,U]})}}return s})()}}]);